<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="戴树谦的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="戴树谦的博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="戴树谦的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>戴树谦的博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">戴树谦的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/15/常见查询示例/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/常见查询示例/" itemprop="url">常见查询示例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T22:34:50+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="常见查询示例"><a href="#常见查询示例" class="headerlink" title="常见查询示例"></a>常见查询示例</h3><p>&ensp;&ensp;假设有一个表格，是商店为某些交易员(经销商)保存每种商品(项目号)的价格。假设每个交易者的每件商品都有一个固定的价格，那么(商品，交易者)就是记录的主键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database shop;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use shop;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table shop_tab(</span><br><span class="line">    -&gt; article int(4) unsigned zerofill default &apos;0000&apos; not null,</span><br><span class="line">    -&gt; dealer char(20) default &apos;&apos; not null,   </span><br><span class="line">    -&gt; price double(16,2) default &apos;0.00&apos; not null,</span><br><span class="line">    -&gt; primary key(article,dealer));</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into shop_tab values</span><br><span class="line">    -&gt; (1,&apos;A&apos;,3.45),(1,&apos;B&apos;,3.99),(2,&apos;A&apos;,10.99),(3,&apos;B&apos;,1.45),(3,&apos;C&apos;,1.69),(3,&apos;D&apos;,1.25),(4,&apos;D&apos;,19.95);</span><br><span class="line">Query OK, 7 rows affected (0.05 sec)</span><br><span class="line">Records: 7  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from shop_tab order by article;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0001 | A      |  3.45 |</span><br><span class="line">|    0001 | B      |  3.99 |</span><br><span class="line">|    0002 | A      | 10.99 |</span><br><span class="line">|    0003 | B      |  1.45 |</span><br><span class="line">|    0003 | C      |  1.69 |</span><br><span class="line">|    0003 | D      |  1.25 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="1-列的最大值"><a href="#1-列的最大值" class="headerlink" title="1.列的最大值"></a>1.列的最大值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select max(price) from shop_tab;</span><br><span class="line">+------------+</span><br><span class="line">| max(price) |</span><br><span class="line">+------------+</span><br><span class="line">|      19.95 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="2-包含某一列的最大值的行"><a href="#2-包含某一列的最大值的行" class="headerlink" title="2.包含某一列的最大值的行"></a>2.包含某一列的最大值的行</h4><p>&ensp;&ensp;使用子查询完成此操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from shop_tab </span><br><span class="line">    -&gt; where price=(select max(price) from shop_tab);</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;按价格降序排序所有行，并使用特定于MySQL的LIMIT子句获取第一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from shop_tab</span><br><span class="line">    -&gt; order by price desc</span><br><span class="line">    -&gt; limit 1;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3-每种商品的最高价格"><a href="#3-每种商品的最高价格" class="headerlink" title="3.每种商品的最高价格"></a>3.每种商品的最高价格</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select article,max(price) as price                                             </span><br><span class="line">    -&gt; from shop_tab</span><br><span class="line">    -&gt; group by article</span><br><span class="line">    -&gt; order by article;</span><br><span class="line">+---------+-------+</span><br><span class="line">| article | price |</span><br><span class="line">+---------+-------+</span><br><span class="line">|    0001 |  3.99 |</span><br><span class="line">|    0002 | 10.99 |</span><br><span class="line">|    0003 |  1.69 |</span><br><span class="line">|    0004 | 19.95 |</span><br><span class="line">+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="4-对于每种商品，找到价格最贵的经销商"><a href="#4-对于每种商品，找到价格最贵的经销商" class="headerlink" title="4.对于每种商品，找到价格最贵的经销商"></a>4.对于每种商品，找到价格最贵的经销商</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1解：以price为条件，使用where s1.article = s2.article或者any操作符使主查询一条记录</span><br><span class="line">    对应子查询的一条记录。</span><br><span class="line">    ANY 关键字必须接在一个比较操作符的后面，表示与子查询返回的任何值比较为 TRUE 则返回 TRUE</span><br><span class="line">    主查询的一条记录对应子查询多条记录会产生错误</span><br><span class="line">    (ERROR 1242 (21000): Subquery returns more than 1 row)。</span><br><span class="line">mysql&gt; select article,dealer,price</span><br><span class="line">    -&gt; from shop_tab as s1</span><br><span class="line">    -&gt; where price=(select max(s2.price)</span><br><span class="line">    -&gt;             from shop_tab as s2</span><br><span class="line">    -&gt;             where s1.article = s2.article</span><br><span class="line">    -&gt;             order by article</span><br><span class="line">    -&gt; );</span><br><span class="line">    或者</span><br><span class="line">    mysql&gt; select article,dealer,price</span><br><span class="line">    -&gt; from shop_tab as s1</span><br><span class="line">    -&gt; where price= any(select max(s2.price)</span><br><span class="line">    -&gt;             from shop_tab as s2</span><br><span class="line">    -&gt;             order by article</span><br><span class="line">    -&gt; );</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0001 | B      |  3.99 |</span><br><span class="line">|    0002 | A      | 10.99 |</span><br><span class="line">|    0003 | C      |  1.69 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">2解：筛选出每件商品最贵的价格作为s2，与原表S1内连接，显示两边表同时有对应的数据，</span><br><span class="line">任何一边缺失数据就不显示</span><br><span class="line">mysql&gt; select s1.article,s1.dealer,s1.price </span><br><span class="line">    -&gt; from shop_tab as s1 join(</span><br><span class="line">    -&gt;                         select article,max(price) as price </span><br><span class="line">    -&gt;                         from shop_tab group by article) as s2 </span><br><span class="line">    -&gt; where s1.article = s2.article and s1.price = s2.price </span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0001 | B      |  3.99 |</span><br><span class="line">|    0002 | A      | 10.99 |</span><br><span class="line">|    0003 | C      |  1.69 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">3解：s2左连接s1，通过s1.article = s2.article 两张表进行价格比较</span><br><span class="line">mysql&gt; select * from shop_tab as s1 </span><br><span class="line">    -&gt; left join shop_tab as s2 </span><br><span class="line">    -&gt; on s1.article = s2.article and s1.price &lt; s2.price;</span><br><span class="line">+---------+--------+-------+---------+--------+-------+</span><br><span class="line">| article | dealer | price | article | dealer | price |</span><br><span class="line">+---------+--------+-------+---------+--------+-------+</span><br><span class="line">|    0001 | A      |  3.45 |    0001 | B      |  3.99 |</span><br><span class="line">|    0001 | B      |  3.99 |    NULL | NULL   |  NULL |</span><br><span class="line">|    0002 | A      | 10.99 |    NULL | NULL   |  NULL |</span><br><span class="line">|    0003 | B      |  1.45 |    0003 | C      |  1.69 |</span><br><span class="line">|    0003 | C      |  1.69 |    NULL | NULL   |  NULL |</span><br><span class="line">|    0003 | D      |  1.25 |    0003 | B      |  1.45 |</span><br><span class="line">|    0003 | D      |  1.25 |    0003 | C      |  1.69 |</span><br><span class="line">|    0004 | D      | 19.95 |    NULL | NULL   |  NULL |</span><br><span class="line">+---------+--------+-------+---------+--------+-------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line">然后再选取s2中为NULL值的行</span><br><span class="line">mysql&gt; select s1.article,s1.dealer,s1.price </span><br><span class="line">    -&gt; from shop_tab as s1 </span><br><span class="line">    -&gt; left join shop_tab as s2 </span><br><span class="line">    -&gt; on s1.article = s2.article AND s1.price &lt; s2.price </span><br><span class="line">    -&gt; where s2.article is null;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0001 | B      |  3.99 |</span><br><span class="line">|    0002 | A      | 10.99 |</span><br><span class="line">|    0003 | C      |  1.69 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="5-用户自定义变量"><a href="#5-用户自定义变量" class="headerlink" title="5.用户自定义变量"></a>5.用户自定义变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @min_price:=min(price),@max_price:=max(price)</span><br><span class="line">    -&gt; from shop_tab;</span><br><span class="line">+------------------------+------------------------+</span><br><span class="line">| @min_price:=min(price) | @max_price:=max(price) |</span><br><span class="line">+------------------------+------------------------+</span><br><span class="line">|                   1.25 |                  19.95 |</span><br><span class="line">+------------------------+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from shop_tab</span><br><span class="line">    -&gt; where price = @min_price:=min(price)</span><br><span class="line">    -&gt; \c                                  </span><br><span class="line">mysql&gt; select * from shop_tab                                      </span><br><span class="line">    -&gt; where price = @min_price or price = @max_price;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0003 | D      |  1.25 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="6-使用外键"><a href="#6-使用外键" class="headerlink" title="6.使用外键"></a>6.使用外键</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE person (</span><br><span class="line">    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name CHAR(60) NOT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE shirt (</span><br><span class="line">    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    style ENUM(&apos;t-shirt&apos;, &apos;polo&apos;, &apos;dress&apos;) NOT NULL,</span><br><span class="line">    color ENUM(&apos;red&apos;, &apos;blue&apos;, &apos;orange&apos;, &apos;white&apos;, &apos;black&apos;) NOT NULL,</span><br><span class="line">    owner SMALLINT UNSIGNED NOT NULL REFERENCES person(id),</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO person VALUES (NULL, &apos;Antonio Paz&apos;);</span><br><span class="line"></span><br><span class="line">SELECT @last := LAST_INSERT_ID();</span><br><span class="line"></span><br><span class="line">INSERT INTO shirt VALUES</span><br><span class="line">(NULL, &apos;polo&apos;, &apos;blue&apos;, @last),</span><br><span class="line">(NULL, &apos;dress&apos;, &apos;white&apos;, @last),</span><br><span class="line">(NULL, &apos;t-shirt&apos;, &apos;blue&apos;, @last);</span><br><span class="line"></span><br><span class="line">INSERT INTO person VALUES (NULL, &apos;Lilliana Angelovska&apos;);</span><br><span class="line"></span><br><span class="line">SELECT @last := LAST_INSERT_ID();</span><br><span class="line"></span><br><span class="line">INSERT INTO shirt VALUES</span><br><span class="line">(NULL, &apos;dress&apos;, &apos;orange&apos;, @last),</span><br><span class="line">(NULL, &apos;polo&apos;, &apos;red&apos;, @last),</span><br><span class="line">(NULL, &apos;dress&apos;, &apos;blue&apos;, @last),</span><br><span class="line">(NULL, &apos;t-shirt&apos;, &apos;white&apos;, @last);</span><br><span class="line"></span><br><span class="line">SELECT * FROM person;</span><br><span class="line">+----+---------------------+</span><br><span class="line">| id | name                |</span><br><span class="line">+----+---------------------+</span><br><span class="line">|  1 | Antonio Paz         |</span><br><span class="line">|  2 | Lilliana Angelovska |</span><br><span class="line">+----+---------------------+</span><br><span class="line"></span><br><span class="line">SELECT * FROM shirt;</span><br><span class="line">+----+---------+--------+-------+</span><br><span class="line">| id | style   | color  | owner |</span><br><span class="line">+----+---------+--------+-------+</span><br><span class="line">|  1 | polo    | blue   |     1 |</span><br><span class="line">|  2 | dress   | white  |     1 |</span><br><span class="line">|  3 | t-shirt | blue   |     1 |</span><br><span class="line">|  4 | dress   | orange |     2 |</span><br><span class="line">|  5 | polo    | red    |     2 |</span><br><span class="line">|  6 | dress   | blue   |     2 |</span><br><span class="line">|  7 | t-shirt | white  |     2 |</span><br><span class="line">+----+---------+--------+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT s.* FROM person p INNER JOIN shirt s</span><br><span class="line">   ON s.owner = p.id</span><br><span class="line"> WHERE p.name LIKE &apos;Lilliana%&apos;</span><br><span class="line">   AND s.color &lt;&gt; &apos;white&apos;;</span><br><span class="line"></span><br><span class="line">+----+-------+--------+-------+</span><br><span class="line">| id | style | color  | owner |</span><br><span class="line">+----+-------+--------+-------+</span><br><span class="line">|  4 | dress | orange |     2 |</span><br><span class="line">|  5 | polo  | red    |     2 |</span><br><span class="line">|  6 | dress | blue   |     2 |</span><br><span class="line">+----+-------+--------+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SHOW CREATE TABLE shirt\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">Table: shirt</span><br><span class="line">Create Table: CREATE TABLE `shirt` (</span><br><span class="line">`id` smallint(5) unsigned NOT NULL auto_increment,</span><br><span class="line">`style` enum(&apos;t-shirt&apos;,&apos;polo&apos;,&apos;dress&apos;) NOT NULL,</span><br><span class="line">`color` enum(&apos;red&apos;,&apos;blue&apos;,&apos;orange&apos;,&apos;white&apos;,&apos;black&apos;) NOT NULL,</span><br><span class="line">`owner` smallint(5) unsigned NOT NULL,</span><br><span class="line">PRIMARY KEY  (`id`)</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=latin1</span><br></pre></td></tr></table></figure>
<h4 id="7-使用两个键搜索"><a href="#7-使用两个键搜索" class="headerlink" title="7.使用两个键搜索"></a>7.使用两个键搜索</h4><p>&ensp;&ensp;逻辑运算符or 使用一个主键能够被很好的优化，就像处理and一样<br>但是使用or去搜索两个不同的主键比较棘手</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index FROM test_table</span><br><span class="line">WHERE field1_index = &apos;1&apos; OR  field2_index = &apos;1&apos;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;可以使用union结合两个单独的select语句进行查询，会更加有效。每个select只搜索一个键则会很好的优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index</span><br><span class="line">    FROM test_table WHERE field1_index = &apos;1&apos;</span><br><span class="line">UNION</span><br><span class="line">SELECT field1_index, field2_index</span><br><span class="line">    FROM test_table WHERE field2_index = &apos;1&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="8-计算每日访问量"><a href="#8-计算每日访问量" class="headerlink" title="8.计算每日访问量"></a>8.计算每日访问量</h4><p>以下示例显示如何使用位组功能计算用户访问网页的每月天数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1 (year YEAR(4), month INT(2) UNSIGNED ZEROFILL,</span><br><span class="line">             day INT(2) UNSIGNED ZEROFILL);</span><br><span class="line">INSERT INTO t1 VALUES(2000,1,1),(2000,1,20),(2000,1,30),(2000,2,2),</span><br><span class="line">            (2000,2,23),(2000,2,23);</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;示例表包含表示用户对页面的访问的年 - 月 - 日值。要确定这些访问每月发生的天数，请使用以下查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT year,month,BIT_COUNT(BIT_OR(1&lt;&lt;day)) AS days FROM t1</span><br><span class="line">       GROUP BY year,month;</span><br><span class="line"></span><br><span class="line">+------+-------+------+</span><br><span class="line">| year | month | days |</span><br><span class="line">+------+-------+------+</span><br><span class="line">| 2000 |    01 |    3 |</span><br><span class="line">| 2000 |    02 |    2 |</span><br><span class="line">+------+-------+------+</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;该查询计算每个年/月组合在表中显示的天数，并自动删除重复的条目</p>
<h4 id="9-使用AUTO-INCREMENT"><a href="#9-使用AUTO-INCREMENT" class="headerlink" title="9.使用AUTO_INCREMENT"></a>9.使用AUTO_INCREMENT</h4><p>该AUTO_INCREMENT属性可用于为新行生成唯一标识：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE animals (</span><br><span class="line">    -&gt; id MEDIUMINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    -&gt; name CHAR(30) NOT NULL,</span><br><span class="line">    -&gt; PRIMARY KEY (id)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.25 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into animals(name) values (&apos;dog&apos;),(&apos;cat&apos;),(&apos;penguin&apos;),(&apos;lax&apos;),(&apos;bird&apos;);</span><br><span class="line">Query OK, 5 rows affected (0.04 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from animals;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | dog     |</span><br><span class="line">|  2 | cat     |</span><br><span class="line">|  3 | penguin |</span><br><span class="line">|  4 | lax     |</span><br><span class="line">|  5 | bird    |</span><br><span class="line">+----+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;AUTO_INCREMENT列没有指定值，因此MySQL自动分配序列号。也可以显式地为列分配0来生成序列号，除非启用了NO_AUTO_VALUE_ON_ZERO SQL模式（NO_AUTO_VALUE_ON_ZERO影响AUTO_INCREMENT列的处理。一般情况下可以向该列插入NULL或0生成下一个序列号）。例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO animals (id,name) VALUES(0,&apos;groundhog&apos;);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from animals;</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | name      |</span><br><span class="line">+----+-----------+</span><br><span class="line">|  1 | dog       |</span><br><span class="line">|  2 | cat       |</span><br><span class="line">|  3 | penguin   |</span><br><span class="line">|  4 | lax       |</span><br><span class="line">|  5 | bird      |</span><br><span class="line">|  6 | groundhog |</span><br><span class="line">+----+-----------+</span><br><span class="line">6 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如果声明了列NOT NULL，则还可以分配NULL给列以生成序列号。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO animals (id,name) VALUES(NULL,&apos;squirrel&apos;);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from animals;</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | name      |</span><br><span class="line">+----+-----------+</span><br><span class="line">|  1 | dog       |</span><br><span class="line">|  2 | cat       |</span><br><span class="line">|  3 | penguin   |</span><br><span class="line">|  4 | lax       |</span><br><span class="line">|  5 | bird      |</span><br><span class="line">|  6 | groundhog |</span><br><span class="line">|  7 | squirrel  |</span><br><span class="line">+----+-----------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;将任何其他值插入AUTO_INCREMENT列时，列被设置为该值，序列被重置，以便下一个自动生成的值按照最大列值的顺序生成。例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;INSERT INTO animals (id,name) VALUES(100,&apos;rabbit&apos;);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">mysql&gt;INSERT INTO animals (id,name) VALUES(NULL,&apos;mouse&apos;);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">SELECT * FROM animals;</span><br><span class="line">+-----+-----------+</span><br><span class="line">| id  | name      |</span><br><span class="line">+-----+-----------+</span><br><span class="line">|   1 | dog       |</span><br><span class="line">|   2 | cat       |</span><br><span class="line">|   3 | penguin   |</span><br><span class="line">|   4 | lax       |</span><br><span class="line">|   5 | whale     |</span><br><span class="line">|   6 | ostrich   |</span><br><span class="line">|   7 | groundhog |</span><br><span class="line">|   8 | squirrel  |</span><br><span class="line">| 100 | rabbit    |</span><br><span class="line">| 101 | mouse     |</span><br><span class="line">+-----+-----------+</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;AUTO_INCREMENT使用LAST_INSERT_ID()  SQL函数或mysql_insert_id()  C API函数检索最新自动生成的值 。这些函数是特定于连接的，因此它们的返回值不受另一个执行插入的连接的影响。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select LAST_INSERT_ID();</span><br><span class="line">+------------------+</span><br><span class="line">| LAST_INSERT_ID() |</span><br><span class="line">+------------------+</span><br><span class="line">|                7 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ul>
<li>对于多行插入，LAST_INSERT_ID()和mysql_insert_id()实际上从插入的第一行返回AUTO_INCREMENT键。</li>
</ul>
<p>&ensp;&ensp;要从除1之外的AUTO_INCREMENT值开始，使用CREATE TABLE或ALTER TABLE设置该值，如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  ALTER TABLE animals AUTO_INCREMENT = 100;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/07/MySQL检索信息/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/07/MySQL检索信息/" itemprop="url">MySQL检索信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-07T18:33:53+08:00">
                2019-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="从表中检索信息"><a href="#从表中检索信息" class="headerlink" title="从表中检索信息"></a>从表中检索信息</h3><p>&ensp;&ensp;该SELECT语句用于从表中提取信息。声明的一般形式是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT what_to_select</span><br><span class="line">FROM which_table</span><br><span class="line">WHERE conditions_to_satisfy;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;what_to_select表示你想看到什么，这可以是列表中的一列， *  可以表示“ 所有列”。which_table表示要从中检索数据的表。该WHERE 条款是可选的。如果存在，则 conditions_to_satisfy指定行必须满足的一个或多个条件才有资格进行检索。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name</span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where sex=&apos;m&apos;；</span><br><span class="line">+--------+</span><br><span class="line">| name   |</span><br><span class="line">+--------+</span><br><span class="line">| Claws  |</span><br><span class="line">| Fang   |</span><br><span class="line">| Bowser |</span><br><span class="line">+--------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="1-选择所有数据"><a href="#1-选择所有数据" class="headerlink" title="1.选择所有数据"></a>1.选择所有数据</h4><p>&ensp;&ensp;SELECT最简单的形式从表中检索所有内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from pet;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1999-02-04 | NULL       |</span><br><span class="line">| Claws  | Gwen   | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Fang   | Benny  | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">| Chirpy | Genw   | bird    | f    | 1998-09-11 | NULL       |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;UPDATE语句修复错误记录 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update pet</span><br><span class="line">    -&gt; set birth=&apos;1990-01-01&apos;</span><br><span class="line">    -&gt; where name=&apos;Bowser&apos;;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-选择特定行"><a href="#2-选择特定行" class="headerlink" title="2.选择特定行"></a>2.选择特定行</h4><p>&ensp;&ensp;例如，如果想验证刚才对Bowser出生日期所做的更改，请选择Bowser的记录，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *     </span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where name=&apos;Bowser&apos;;</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| name   | owner | species | sex  | birth      | death      |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| Bowser | Diane | dog     | m    | 1990-01-01 | 1995-07-29 |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;字符串比较通常不区分大小写，因此可以将名称指定为’bowser’， ‘BOWSER’等等。查询结果是一样的。</p>
<p>&ensp;&ensp;也可以在任何列上指定条件，例如想知道1997年或之后出生的动物：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *                                       </span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where birth &gt;= &apos;1997-02-22&apos;;</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1999-02-04 | NULL  |</span><br><span class="line">| Chirpy | Genw   | bird    | f    | 1998-09-11 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;还可以使用  AND  进行组合条件进行查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *      </span><br><span class="line">    -&gt; from pet </span><br><span class="line">    -&gt; where species = &apos;dog&apos; and sex = &apos;m&apos;;</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| name   | owner | species | sex  | birth      | death      |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| Fang   | Benny | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser | Diane | dog     | m    | 1990-01-01 | 1995-07-29 |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;除了AND逻辑运算符还有OR。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *                                                        </span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where species = &apos;dog&apos; or species = &apos;bird&apos;;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Fang   | Benny  | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1990-01-01 | 1995-07-29 |</span><br><span class="line">| Chirpy | Genw   | bird    | f    | 1998-09-11 | NULL       |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;AND和OR可以混合，但 AND优先级高于 OR。如果同时使用这两个运算符，最好使用括号明确指出条件应如何分组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *     </span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where (species=&apos;dog&apos; and sex=&apos;f&apos;) or (species=&apos;bird&apos; and sex=&apos;f&apos;);</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">| Chirpy | Genw   | bird    | f    | 1998-09-11 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3-选择特定列"><a href="#3-选择特定列" class="headerlink" title="3.选择特定列"></a>3.选择特定列</h4><p>&ensp;&ensp;如果不查看表中的整行，只需将感兴趣的列名进行逗号分隔。例如如果查询谁的动物什么时候出生，请选择name和 birth列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet;</span><br><span class="line">+--------+------------+</span><br><span class="line">| name   | birth      |</span><br><span class="line">+--------+------------+</span><br><span class="line">| Fluffy | 1999-02-04 |</span><br><span class="line">| Claws  | 1994-03-17 |</span><br><span class="line">| Buffy  | 1989-05-13 |</span><br><span class="line">| Fang   | 1990-08-27 |</span><br><span class="line">| Bowser | 1990-01-01 |</span><br><span class="line">| Chirpy | 1998-09-11 |</span><br><span class="line">+--------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;要找出宠物属于谁，如下查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select owner from pet;</span><br><span class="line">+--------+</span><br><span class="line">| owner  |</span><br><span class="line">+--------+</span><br><span class="line">| Harold |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Harold |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">| Genw   |</span><br><span class="line">+--------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;要最小化输出，请通过添加关键字 <strong>DISTINCT</strong> 去除重复输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct owner from pet;</span><br><span class="line">+--------+</span><br><span class="line">| owner  |</span><br><span class="line">+--------+</span><br><span class="line">| Harold |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">| Genw   |</span><br><span class="line">+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;使用WHERE子句将行选择与列选择组合在一起。例如，仅获取狗和猫的出生日期，如下查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,species,birth</span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where species = &apos;dog&apos; or species = &apos;cat&apos;;</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| name   | species | birth      |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| Fluffy | cat     | 1999-02-04 |</span><br><span class="line">| Claws  | cat     | 1994-03-17 |</span><br><span class="line">| Buffy  | dog     | 1989-05-13 |</span><br><span class="line">| Fang   | dog     | 1990-08-27 |</span><br><span class="line">| Bowser | dog     | 1990-01-01 |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="4-对行排序"><a href="#4-对行排序" class="headerlink" title="4.对行排序"></a>4.对行排序</h4><p>&ensp;&ensp;当行以某种有意义的方式排序时，通常更容易查询输出。要对结果进行排序，请使用<strong>ORDER BY</strong>子句。<br>&ensp;&ensp;默认排序顺序是升序。要按反向（降序）排序，请将<strong>DESC</strong>关键字添加到要排序 的列名称后面  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name, birth from pet order by birth;</span><br><span class="line">+--------+------------+</span><br><span class="line">| name   | birth      |</span><br><span class="line">+--------+------------+</span><br><span class="line">| Buffy  | 1989-05-13 |</span><br><span class="line">| Bowser | 1990-01-01 |</span><br><span class="line">| Fang   | 1990-08-27 |</span><br><span class="line">| Claws  | 1994-03-17 |</span><br><span class="line">| Chirpy | 1998-09-11 |</span><br><span class="line">| Fluffy | 1999-02-04 |</span><br><span class="line">+--------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select name, species, birth from pet</span><br><span class="line">    -&gt; order by species,birth desc;</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| name   | species | birth      |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| Chirpy | bird    | 1998-09-11 |</span><br><span class="line">| Fluffy | cat     | 1999-02-04 |</span><br><span class="line">| Claws  | cat     | 1994-03-17 |</span><br><span class="line">| Fang   | dog     | 1990-08-27 |</span><br><span class="line">| Bowser | dog     | 1990-01-01 |</span><br><span class="line">| Buffy  | dog     | 1989-05-13 |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;该DESC关键字仅适用于紧邻的列名（birth）; 它不会影响species列排序顺序。  </p>
<p>&ensp;&ensp;<strong>LIMIT</strong> 子句用于限制由 SELECT 语句返回的数据数量。下面是 LIMIT 子句与 OFFSET 子句一起使用时的语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, columnN </span><br><span class="line">FROM table_name</span><br><span class="line">LIMIT [no of rows] OFFSET [row num]</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;引擎将返回从下一行开始直到给定的 OFFSET 为止的所有行。</p>
<h4 id="5-日期计算"><a href="#5-日期计算" class="headerlink" title="5.日期计算"></a>5.日期计算</h4><p>&ensp;&ensp;要确定每只宠物的年龄，使用 TIMESTAMPDIFF()功能。它的参数是你所希望结果表达的 单位，以及取得差异的两个日期。以下查询显示了每只宠物的出生日期，当前日期和年龄。一个 别名（age）使得输出列更有意义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, CURDATE(),</span><br><span class="line">    -&gt; TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</span><br><span class="line">    -&gt; FROM pet;</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">| name   | birth      | CURDATE()  | age  |</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">| Fluffy | 1999-02-04 | 2019-02-19 |   20 |</span><br><span class="line">| Claws  | 1994-03-17 | 2019-02-19 |   25 |</span><br><span class="line">| Buffy  | 1989-05-13 | 2019-02-19 |   29 |</span><br><span class="line">| Fang   | 1990-08-27 | 2019-02-19 |   28 |</span><br><span class="line">| Bowser | 1990-01-01 | 2019-02-19 |   29 |</span><br><span class="line">| Chirpy | 1998-09-11 | 2019-02-19 |   20 |</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;也可以使用order by 对age进行排序，不再演示  </p>
<hr>
<p>&ensp;&ensp;下面说明TIMESTAMPDIFF函数的语法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TIMESTAMPDIFF(unit,begin,end);</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;TIMESTAMPDIFF函数返回begin-end的结果，其中begin和end是DATE或DATETIME表达式。</p>
<p>&ensp;&ensp;TIMESTAMPDIFF函数允许其参数具有混合类型，例如，begin是DATE值，end可以是DATETIME值。 如果使用DATE值，则TIMESTAMPDIFF函数将其视为时间部分为“00:00:00”的DATETIME值。</p>
<p>&ensp;&ensp;unit参数是确定(end-begin)的结果的单位，表示为整数。 以下是有效单位：<br>MICROSECOND(微秒)、SECOND(秒)、MINUTE(分钟)、HOUR(小时)、DAY(天)、WEEK(星期)、MONTH(月)、QUARTER(季度)、YEAR(年)</p>
<hr>
<p>&ensp;&ensp;类似的查询可用于确定死亡动物的死亡年龄。可以通过检查death值是否为null 。然后，对于那些非NULL值的，计算death和 birth值之差： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,birth,death,</span><br><span class="line">    -&gt; timestampdiff(year,birth,death) as age</span><br><span class="line">    -&gt; from pet            </span><br><span class="line">    -&gt; where death is not null</span><br><span class="line">    -&gt; order by age;</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">| name   | birth      | death      | age  |</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">| Bowser | 1990-01-01 | 1995-07-29 |    5 |</span><br><span class="line">+--------+------------+------------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;MySQL提供了用于提取日期的部分，如一些功能 YEAR()， MONTH()和 DAYOFMONTH()。如下一个简单的查询birth和 MONTH(birth)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,birth,month(birth) from pet; </span><br><span class="line">+--------+------------+--------------+</span><br><span class="line">| name   | birth      | month(birth) |</span><br><span class="line">+--------+------------+--------------+</span><br><span class="line">| Fluffy | 1999-02-04 |            2 |</span><br><span class="line">| Claws  | 1994-03-17 |            3 |</span><br><span class="line">| Buffy  | 1989-05-13 |            5 |</span><br><span class="line">| Fang   | 1997-02-22 |            2 |</span><br><span class="line">| Bowser | 1990-01-01 |            1 |</span><br><span class="line">| Chirpy | 1998-09-11 |            9 |</span><br><span class="line">+--------+------------+--------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select name,birth </span><br><span class="line">    -&gt; from pet </span><br><span class="line">    -&gt; where month(birth)=5;</span><br><span class="line">+-------+------------+</span><br><span class="line">| name  | birth      |</span><br><span class="line">+-------+------------+</span><br><span class="line">| Buffy | 1989-05-13 |</span><br><span class="line">+-------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;DATE_ADD()可以将时间间隔添加到给定日期。如果将值添加到CURDATE()，然后提取月份部分MONTH()，结果将生成查找生日的月份：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,birth from pet</span><br><span class="line">    -&gt; where month(birth)=month(date_add(curdate(),interval 2 month));</span><br><span class="line">+-------+------------+</span><br><span class="line">| name  | birth      |</span><br><span class="line">+-------+------------+</span><br><span class="line">| Buffy | 1989-05-13 |</span><br><span class="line">+-------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="6-null-值"><a href="#6-null-值" class="headerlink" title="6.null 值"></a>6.null 值</h4><p>&ensp;&ensp;要测试NULL，请使用<strong>IS NULL</strong> 和 <strong>IS NOT NULL</strong>运算符，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 1 IS NULL, 1 IS NOT NULL</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| 1 IS NULL | 1 IS NOT NULL |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">|         0 |             1 |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;任何算术比较NULL的结果 也是NULL，所以你不能从这种比较中获得任何有意义的结果。<br>&ensp;&ensp;在MySQL中，0或NULL 为假，其他则为真。布尔运算的默认真值是1。</p>
<h4 id="7-模式匹配"><a href="#7-模式匹配" class="headerlink" title="7.模式匹配"></a>7.模式匹配</h4><p>&ensp;&ensp;MySQL提供标准的SQL模式匹配以及基于扩展正则表达式的模式匹配，类似于Unix实用程序（如vi，grep和 sed）使用的扩展正则表达式 。</p>
<p>&ensp;&ensp;SQL模式匹配可以使用 “_”  匹配任何单个字符并且%匹配任意数量的字符（包括零个字符）。在MySQL中，SQL模式默认情况下不区分大小写。使                               用SQL模式时不要使用 =或&lt;&gt;，改用LIKE或 NOT LIKE比较运算符。 </p>
<p>&ensp;&ensp;查找以b（b%）开头。%fy（以fy结尾），%w%（包含w字符）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select  *</span><br><span class="line">    -&gt; from pet</span><br><span class="line">    -&gt; where name like &apos;b%&apos;;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1990-01-01 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;要查找包含五个字符的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from pet where name like &apos;_____&apos;;</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;MySQL提供的另一种模式匹配使用扩展的正则表达式。当为这种类型的模式测试匹配时，使用 REGEXP和NOT REGEXP运算符（或 RLIKE和 NOT RLIKE，它们是同义词）。</p>
<p>&ensp;&ensp;以下列表描述了扩展正则表达式的一些特征：</p>
<p>&ensp;&ensp;. 匹配任何单个字符。<br>字符类[…]匹配括号内的任何字符。例如， [abc]匹配a， b或c。[a-z] 匹配任何字母，而[0-9] 匹配任何数字。</p>
<p>&ensp;&ensp;*匹配前面事物的零个或多个实例。例如，x<em> 匹配任意数量的x字符， [0-9]</em>匹配任意数量的数字，.*匹配任意数量的任何字符。</p>
<p>&ensp;&ensp;如果模式与测试值中的任何位置匹配，则正则表达式模式匹配成功 。（这与LIKE模式匹配不同，仅在模式与整个值匹配时才会成功。）<br>使用锚定模式以使其与要测试的值的开头或结尾匹配，请使用模式^开头或$结尾。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from pet where name regexp &apos;^b&apos;;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1990-01-01 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="8-计数行"><a href="#8-计数行" class="headerlink" title="8.计数行"></a>8.计数行</h4><p>&ensp;&ensp;COUNT(*)计算行数，因此计算动物数量的查询如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*) from pet;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        6 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;计算每个人拥有几个宠物</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select owner,count(*) from pet group by owner;</span><br><span class="line">+--------+----------+</span><br><span class="line">| owner  | count(*) |</span><br><span class="line">+--------+----------+</span><br><span class="line">| Benny  |        1 |</span><br><span class="line">| Diane  |        1 |</span><br><span class="line">| Genw   |        1 |</span><br><span class="line">| Gwen   |        1 |</span><br><span class="line">| Harold |        2 |</span><br><span class="line">+--------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;上述查询使用GROUP BY对每个owner进行分组。使用COUNT()结合 GROUP BY在各种分组表征数据时非常有用。 </p>
<p>&ensp;&ensp;想要得到每种性别的动物数量仅适用于已知性别的动物：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select species,sex,count(*)                                            </span><br><span class="line">    -&gt; from pet </span><br><span class="line">    -&gt; where sex is not null</span><br><span class="line">    -&gt; group by species,sex;</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| species | sex  | count(*) |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| bird    | f    |        1 |</span><br><span class="line">| cat     | f    |        1 |</span><br><span class="line">| cat     | m    |        1 |</span><br><span class="line">| dog     | f    |        1 |</span><br><span class="line">| dog     | m    |        2 |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="9-使用多个表"><a href="#9-使用多个表" class="headerlink" title="9.使用多个表"></a>9.使用多个表</h4><p>&ensp;&ensp;pet 表记录了宠物的基本信息，还需要一张表记录他们生活中的事件，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table event (name varchar(20),date date,type varchar(20),remark varchar(250));</span><br><span class="line">Query OK, 0 rows affected (0.30 sec)</span><br><span class="line">mysql&gt; select * from event;                                          </span><br><span class="line">+--------+------------+--------+-----------------+</span><br><span class="line">| name   | date       | type   | remark          |</span><br><span class="line">+--------+------------+--------+-----------------+</span><br><span class="line">| Fluffy | 1995-05-15 | litter | 4,3female,1male |</span><br><span class="line">| Buffy  | 1993-06-23 | litter | 4,3female,1male |</span><br><span class="line">| Buffy  | 1994-06-19 | litter | 4,3female,1male |</span><br><span class="line">| Chirpy | 1999-03-19 | daily  | go away         |</span><br><span class="line">| Fang   | 1991-10-12 | kennel | NULL            |</span><br><span class="line">| Bowser | 1991-10-12 | kennel | NULL            |</span><br><span class="line">+--------+------------+--------+-----------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;假设你想要得到宠物下崽的年龄。宠物的下崽日期在 event表格中，但要计算她在该日期的年龄，需要她的出生日期，该日期存储在 pet表格中。这意味着查询需要两个表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select pet.name,timestampdiff(year,birth,date) as age,remark </span><br><span class="line">    -&gt; from pet inner join event </span><br><span class="line">    -&gt; on pet.name = event.name</span><br><span class="line">    -&gt; where event.type=&apos;litter&apos;;</span><br><span class="line">+--------+------+-----------------+</span><br><span class="line">| name   | age  | remark          |</span><br><span class="line">+--------+------+-----------------+</span><br><span class="line">| Fluffy |    3 | 4,3female,1male |</span><br><span class="line">| Buffy  |    4 | 4,3female,1male |</span><br><span class="line">| Buffy  |    5 | 4,3female,1male |</span><br><span class="line">+--------+------+-----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;该FROM子句连接两个表，因为查询需要从两个表中提取信息</p>
<p>&ensp;&ensp;组合（连接）来自多个表的信息时，需要指定一个表中的记录如何与另一个表中的记录匹配。</p>
<p>&ensp;&ensp;该查询使用 INNER JOIN来组合表。只有当两个表都满足ON子句中指定的条件时，内部联接才允许其中一个表中的行出现在结果中。在这个例子中， ON子句指定  pet表中的name列必须的匹配 event表的name列 。如果名称出现在一个表中但不出现在另一个表中，则该行不会出现在结果中，因为该ON 子句中的条件失败。</p>
<p>&ensp;&ensp;由于该name列出现在两个表中，因此必须具体说明引用该列时的表。这是通过将表名添加到列名称来完成的。</p>
<p>&ensp;&ensp;如果要将表中的记录与同一表中的其他记录进行比较，有时将表连接到自身会很有用。例如，要在宠物中找到繁殖对，可以pet自身加入表格，以生成候选对：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select p1.name,p1.sex,p2.name,p2.sex,p1.species </span><br><span class="line">    -&gt;from pet as p1 inner join pet as p2 </span><br><span class="line">    -&gt;on p1.species = p2.species </span><br><span class="line">    -&gt;and p1.sex = &apos;f&apos; and p1.death is null </span><br><span class="line">    -&gt;and p2.sex = &apos;m&apos; and p2.death is null;</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| name   | sex  | name  | sex  | species |</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| Fluffy | f    | Claws | m    | cat     |</span><br><span class="line">| Buffy  | f    | Fang  | m    | dog     |</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;在此查询中，我们为表名指定别名以引用列，并保持每个列引用与表关联的表的实例。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/02/MySQL语句(菜鸟教程)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/02/MySQL语句(菜鸟教程)/" itemprop="url">MySQL语句(菜鸟教程)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-02T22:43:33+08:00">
                2019-02-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  20
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p>语法为：<br>CREATE DATABASE 数据库名;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database dsq_mysql;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><p>语法为:<br>drop database &lt;数据库名&gt;;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database test;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h4><p>&ensp;&ensp;在你连接到 MySQL 数据库后，可能有多个可以操作的数据库，所以你需要选择你要操作的数据库。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| 16netlab           |</span><br><span class="line">| dsq_mysql          |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| shop               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use dsq_mysql;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>
<h4 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h4><p>创建MySQL数据表需要 表名、表字段名、表字段定义:<br>CREATE TABLE table_name (column_name column_type);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table dsq_table(</span><br><span class="line">    -&gt; dsq_id int unsigned auto_increment,</span><br><span class="line">    -&gt; title varchar(100) not null,</span><br><span class="line">    -&gt; name varchar(20) not null,</span><br><span class="line">    -&gt; sex varchar(10) not null,</span><br><span class="line">    -&gt; date DATE    ,</span><br><span class="line">    -&gt; primary key(dsq_id))</span><br><span class="line">    -&gt; default charset=utf8;</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc dsq_table;</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| dsq_id | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(100)     | NO   |     | NULL    |                |</span><br><span class="line">| name   | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| sex    | varchar(10)      | NO   |     | NULL    |                |</span><br><span class="line">| date   | DATE             | YES  |     | NULL    |                |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="删除数据表"><a href="#删除数据表" class="headerlink" title="删除数据表"></a>删除数据表</h4><p>语法为:<br>DROP TABLE table_name ;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop table test;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure>
<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><p>MySQL 表中使用 INSERT INTO SQL语句来插入数据。<br>语法为：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name ( field1, field2,...fieldN )  </span><br><span class="line">                       VALUES  </span><br><span class="line">                       ( value1, value2,...valueN )；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into dsq_table (title,name,sex,date)</span><br><span class="line">    -&gt; values</span><br><span class="line">    -&gt; (&apos;study&apos;,&apos;qwe&apos;,&apos;m&apos;,now());</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.22 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into dsq_table (title,name,sex,date)</span><br><span class="line">    -&gt; values</span><br><span class="line">    -&gt; (&apos;play&apos;,&apos;asd&apos;,&apos;f&apos;,&apos;2008-02-22&apos;);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><p>MySQL 数据库使用SQL SELECT语句来查询数据。<br> 以下为在MySQL数据库中查询数据通用的 SELECT 语法：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name,column_name</span><br><span class="line">FROM table_name</span><br><span class="line">[WHERE Clause]</span><br><span class="line">[LIMIT N][ OFFSET M]</span><br></pre></td></tr></table></figure>
<ul>
<li>查询语句中可以使用一个或者多个表，表之间使用逗号(,)分割，并使用WHERE语句来设定查询条件。</li>
<li>SELECT 命令可以读取一条或者多条记录。</li>
<li>可以使用星号（*）来代替其他字段，SELECT语句会返回表的所有字段数据</li>
<li>可以使用 WHERE 语句来包含任何条件。</li>
<li>可以使用 LIMIT 属性来设定返回的记录数。</li>
<li>可以通过OFFSET指定SELECT语句开始查询的数据偏移量。默认情况下偏移量为0。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_table;</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">| dsq_id | title | name | sex | date       |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">|      1 | study | qwe  | m   | 2019-02-21 |</span><br><span class="line">|      2 | play  | asd  | f   | 2008-02-22 |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select name,sex from dsq_table;</span><br><span class="line">+------+-----+</span><br><span class="line">| name | sex |</span><br><span class="line">+------+-----+</span><br><span class="line">| qwe  | m   |</span><br><span class="line">| asd  | f   |</span><br><span class="line">+------+-----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="where子句"><a href="#where子句" class="headerlink" title="where子句"></a>where子句</h4><p>&ensp;&ensp;如需有条件地从表中选取数据，可将 WHERE 子句添加到 SELECT 语句中。<br>语法如下:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1, field2,...fieldN FROM table_name1, table_name2...</span><br><span class="line">[WHERE condition1 [AND [OR]] condition2.....</span><br></pre></td></tr></table></figure>
<ul>
<li>查询语句中可以使用一个或者多个表，表之间使用逗号, 分割，并使用WHERE语句来设定查询条件。</li>
<li>可以在 WHERE 子句中指定任何条件。</li>
<li>可以使用 AND 或者 OR 指定一个或多个条件。</li>
<li>WHERE 子句也可以运用于 SQL 的 DELETE 或者 UPDATE 命令。</li>
<li>WHERE 子句类似于程序语言中的 if 条件，根据 MySQL 表中的字段值来读取指定的数据。</li>
<li>WHERE 子句的字符串比较是不区分大小写的。 使用 BINARY 关键字来设定 WHERE 子句的字符串比较是区分大小写的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_table </span><br><span class="line">    -&gt; where sex = &apos;m&apos;;</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">| dsq_id | title | name | sex | date       |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">|      1 | study | qwe  | m   | 2019-02-21 |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dsq_table </span><br><span class="line">    -&gt; where binary sex = &apos;F&apos;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dsq_table </span><br><span class="line">    -&gt; where dsq_id &gt; 1;</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">| dsq_id | title | name | sex | date       |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">|      2 | play  | asd  | f   | 2008-02-22 |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="Update查询"><a href="#Update查询" class="headerlink" title="Update查询"></a>Update查询</h4><p>&ensp;&ensp;需要修改或更新 MySQL 中的数据，我们可以使用 SQL UPDATE 命令来操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name SET field1=new-value1, field2=new-value2</span><br><span class="line">[WHERE Clause]</span><br></pre></td></tr></table></figure>
<ul>
<li>可以同时更新一个或多个字段。</li>
<li>可以在 WHERE 子句中指定任何条件。</li>
<li>可以在一个单独表中同时更新数据。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update dsq_table set name = &apos;zxc&apos;,date = &apos;2000-01-01&apos; </span><br><span class="line">    -&gt; where dsq_id = 2;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line">mysql&gt; select * from dsq_table;</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">| dsq_id | title | name | sex | date       |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">|      1 | study | qwe  | m   | 2019-02-21 |</span><br><span class="line">|      2 | play  | zxc  | f   | 2000-01-01 |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>可以看到第二行已经更新</p>
<h4 id="delect-语句"><a href="#delect-语句" class="headerlink" title="delect 语句"></a>delect 语句</h4><p>&ensp;&ensp;使用 SQL 的 DELETE FROM 命令来删除 MySQL 数据表中的记录  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM table_name [WHERE Clause]</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如果没有指定 WHERE 子句，MySQL 表中的所有记录将被删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from dsq_table  </span><br><span class="line">    -&gt; where dsq_id = 1;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dsq_table;</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">| dsq_id | title | name | sex | date       |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">|      2 | play  | zxc  | f   | 2000-01-01 |</span><br><span class="line">+--------+-------+------+-----+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="like子句"><a href="#like子句" class="headerlink" title="like子句"></a>like子句</h4><p>&ensp;&ensp;有时候我们需要根据某个字符去匹配某个字段(field)中的所有记录,即模糊查询、模式匹配，这时我们就需要在 WHERE 子句中使用 SQL LIKE 子句。<br>&ensp;&ensp; SQL LIKE 子句中使用百分号 %字符来表示任意字符，类似于UNIX或正则表达式中的星号 *。<br>如果没有使用百分号 %, LIKE 子句与等号 = 的效果是一样的。<br>语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1, field2,...fieldN </span><br><span class="line">FROM table_name</span><br><span class="line">WHERE field1 LIKE condition1 [AND [OR]] filed2 = &apos;somevalue&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_table </span><br><span class="line">    -&gt; where title like &apos;%lab&apos;;</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">| dsq_id | title  | name | sex | date       |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">|      3 | netlab | dsq  | f   | 2019-03-25 |</span><br><span class="line">|      4 | netlab | dsq  | m   | 2019-03-25 |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="排序-order-by"><a href="#排序-order-by" class="headerlink" title="排序(order by)"></a>排序(order by)</h4><p>&ensp;&ensp;如果我们需要对读取的数据进行排序，我们就可以使用 MySQL 的 ORDER BY 子句来设定按哪个字段哪种方式来进行排序，再返回搜索结果<br>语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/*ASC 或 DESC 关键字来设置查询结果是按升序或降序排列。 默认情况下，它是按升序排列*/</span><br><span class="line">SELECT field1, field2,...fieldN table_name1, table_name2...</span><br><span class="line">ORDER BY field1, [field2...] [ASC [DESC]]</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;下面读取dsq_table表，按照升序和降序的方式排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_table</span><br><span class="line">    -&gt; order by dsq_id;</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">| dsq_id | title  | name | sex | date       |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">|      2 | play   | zxc  | f   | 2000-01-01 |</span><br><span class="line">|      3 | netlab | dsq  | f   | 2019-03-25 |</span><br><span class="line">|      4 | netlab | dsq  | m   | 2019-03-25 |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dsq_table </span><br><span class="line">    -&gt; order by dsq_id desc;</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">| dsq_id | title  | name | sex | date       |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">|      4 | netlab | dsq  | m   | 2019-03-25 |</span><br><span class="line">|      3 | netlab | dsq  | f   | 2019-03-25 |</span><br><span class="line">|      2 | play   | zxc  | f   | 2000-01-01 |</span><br><span class="line">+--------+--------+------+-----+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="GROUP-BY-语句"><a href="#GROUP-BY-语句" class="headerlink" title="GROUP BY 语句"></a>GROUP BY 语句</h4><p>&ensp;&ensp;GROUP BY 语句根据一个或多个列对结果集进行分组。在分组的列上我们可以使用 COUNT, SUM, AVG,等函数。<br>&ensp;&ensp;语法为：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name, function(column_name)</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE column_name operator value</span><br><span class="line">GROUP BY column_name;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;创建表emplotee_tbl，并插入数据，使用 GROUP BY 语句 将数据表按名字进行分组，并统计每个人有多少条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM employee_tbl;</span><br><span class="line">+----+------+---------------------+--------+</span><br><span class="line">| id | name | date                | singin |</span><br><span class="line">+----+------+---------------------+--------+</span><br><span class="line">|  1 | ming | 2016-04-22 15:25:33 |      1 |</span><br><span class="line">|  2 | wang | 2016-04-20 15:25:47 |      3 |</span><br><span class="line">|  3 | li   | 2016-04-19 15:26:02 |      2 |</span><br><span class="line">|  4 | wang | 2016-04-07 15:26:14 |      4 |</span><br><span class="line">|  5 | ming | 2016-04-11 15:26:40 |      4 |</span><br><span class="line">|  6 | ming | 2016-04-04 15:26:54 |      2 |</span><br><span class="line">+----+------+---------------------+--------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT name, COUNT(*) FROM employee_tbl GROUP BY name;</span><br><span class="line">+------+----------+</span><br><span class="line">| name | COUNT(*) |</span><br><span class="line">+------+----------+</span><br><span class="line">| li   |        1 |</span><br><span class="line">| ming |        3 |</span><br><span class="line">| wang |        2 |</span><br><span class="line">+------+----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;GROUP BY子句 <strong>WITH ROLLUP</strong> ，可以实现在分组统计数据基础上再进行相同的统计</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,sum(singin) as singin_count </span><br><span class="line">    -&gt; from employee_tbl</span><br><span class="line">    -&gt; group by name with rollup;</span><br><span class="line">+------+--------------+</span><br><span class="line">| name | singin_count |</span><br><span class="line">+------+--------------+</span><br><span class="line">| li   |            2 |</span><br><span class="line">| ming |            7 |</span><br><span class="line">| wang |            7 |</span><br><span class="line">| NULL |           16 |</span><br><span class="line">+------+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;与上表相比多了一行对每人登录次数的统计,可以使用coalesce设置一个取代Null的名称<br>语法为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select coalesce(a,b,c);</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;返回第一个非零参数或者NULL（Returns the first non-NULL value in the list, or NULL if there are no non-NULL values.）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT COALESCE(NULL,1);</span><br><span class="line">+------------------+</span><br><span class="line">| COALESCE(NULL,1) |</span><br><span class="line">+------------------+</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT COALESCE(NULL,null,null);</span><br><span class="line">+--------------------------+</span><br><span class="line">| COALESCE(NULL,NULL,NULL) |</span><br><span class="line">+--------------------------+</span><br><span class="line">|                     NULL |</span><br><span class="line">+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select coalesce(name,&apos;total&apos;),sum(singin) as singin_count </span><br><span class="line">    -&gt; from employee_tbl</span><br><span class="line">    -&gt; group by name with rollup;</span><br><span class="line">+------------------------+--------------+</span><br><span class="line">| coalesce(name,&apos;total&apos;) | singin_count |</span><br><span class="line">+------------------------+--------------+</span><br><span class="line">| li                     |            2 |</span><br><span class="line">| ming                   |            7 |</span><br><span class="line">| wang                   |            7 |</span><br><span class="line">| total                  |           16 |</span><br><span class="line">+------------------------+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="MySQL连接表"><a href="#MySQL连接表" class="headerlink" title="MySQL连接表"></a>MySQL连接表</h4><p>&ensp;&ensp;可以在 SELECT, UPDATE 和 DELETE 语句中使用 Mysql 的 JOIN 来联合多表查询。<br>&ensp;&ensp;JOIN 按照功能大致分为如下三类：  </p>
<ul>
<li>INNER JOIN（内连接,或等值连接）：两边表同时有对应的数据，即任何一边缺失数据就不显示。  </li>
<li>LEFT JOIN（左连接）：获取左表所有记录，即使右表没有对应匹配的记录。  </li>
<li>RIGHT JOIN（右连接）： 与 LEFT JOIN 相反，用于获取右表所有记录，即使左表没有对应匹配的记录。</li>
</ul>
<p>有如下两个表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_tbl;</span><br><span class="line">+----+-------+--------+------------+</span><br><span class="line">| id | title | author | date       |</span><br><span class="line">+----+-------+--------+------------+</span><br><span class="line">|  1 | qwe   | 1      | 2000-01-01 |</span><br><span class="line">|  2 | rty   | 2      | 2000-01-02 |</span><br><span class="line">|  3 | uiop  | 1      | 2000-01-03 |</span><br><span class="line">|  4 | asd   | 3      | 2000-01-04 |</span><br><span class="line">|  5 | fghj  | 2      | 2000-01-05 |</span><br><span class="line">|  6 | kl    | 4      | 2000-01-06 |</span><br><span class="line">+----+-------+--------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dsq_tbl2;</span><br><span class="line">+--------+-------+</span><br><span class="line">| author | stars |</span><br><span class="line">+--------+-------+</span><br><span class="line">| 1      | 20    |</span><br><span class="line">| 2      | 35    |</span><br><span class="line">| 3      | 47    |</span><br><span class="line">+--------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;接下来使用 inner join(也可以省略 inner 使用 join，效果一样)来连接两张表并显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_tbl inner join dsq_tbl2 </span><br><span class="line">    -&gt; on dsq_tbl.author = dsq_tbl2.author;</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">| id | title | author | date       | author | stars |</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">|  1 | qwe   | 1      | 2000-01-01 | 1      | 20    |</span><br><span class="line">|  2 | rty   | 2      | 2000-01-02 | 2      | 35    |</span><br><span class="line">|  3 | uiop  | 1      | 2000-01-03 | 1      | 20    |</span><br><span class="line">|  4 | asd   | 3      | 2000-01-04 | 3      | 47    |</span><br><span class="line">|  5 | fghj  | 2      | 2000-01-05 | 2      | 35    |</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line">以上语句等价于 select * from dsq_tbl,dsq_tbl2 WHERE dsq_tbl.author = dsq_tbl2.author;</span><br></pre></td></tr></table></figure>
<p> &ensp;&ensp;left join 与 join 有所不同。  left join 会读取左边数据表的全部数据，即便右边表无对应数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_tbl left join dsq_tbl2  </span><br><span class="line">    -&gt; on dsq_tbl.author = dsq_tbl2.author;</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">| id | title | author | date       | author | stars |</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">|  1 | qwe   | 1      | 2000-01-01 | 1      | 20    |</span><br><span class="line">|  3 | uiop  | 1      | 2000-01-03 | 1      | 20    |</span><br><span class="line">|  2 | rty   | 2      | 2000-01-02 | 2      | 35    |</span><br><span class="line">|  5 | fghj  | 2      | 2000-01-05 | 2      | 35    |</span><br><span class="line">|  4 | asd   | 3      | 2000-01-04 | 3      | 47    |</span><br><span class="line">|  6 | kl    | 4      | 2000-01-06 | NULL   | NULL  |</span><br><span class="line">+----+-------+--------+------------+--------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;right join  会读取右边数据表的全部数据，即便左边边表无对应数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_tbl right  join dsq_tbl2 on dsq_tbl.author = dsq_tbl2.author;</span><br><span class="line">+------+-------+--------+------------+--------+-------+</span><br><span class="line">| id   | title | author | date       | author | stars |</span><br><span class="line">+------+-------+--------+------------+--------+-------+</span><br><span class="line">|    1 | qwe   | 1      | 2000-01-01 | 1      | 20    |</span><br><span class="line">|    2 | rty   | 2      | 2000-01-02 | 2      | 35    |</span><br><span class="line">|    3 | uiop  | 1      | 2000-01-03 | 1      | 20    |</span><br><span class="line">|    4 | asd   | 3      | 2000-01-04 | 3      | 47    |</span><br><span class="line">|    5 | fghj  | 2      | 2000-01-05 | 2      | 35    |</span><br><span class="line">+------+-------+--------+------------+--------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>下面为一个left  join  的应用场景</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">查找所有员工的last_name和first_name以及对应部门编号dept_no，也包括展示没有分配具体部门的员工</span><br><span class="line">CREATE TABLE `dept_emp` (</span><br><span class="line">`emp_no` int(11) NOT NULL,</span><br><span class="line">`dept_no` char(4) NOT NULL,</span><br><span class="line">`from_date` date NOT NULL,</span><br><span class="line">`to_date` date NOT NULL,</span><br><span class="line">PRIMARY KEY (`emp_no`,`dept_no`));</span><br><span class="line">CREATE TABLE `employees` (</span><br><span class="line">`emp_no` int(11) NOT NULL,</span><br><span class="line">`birth_date` date NOT NULL,</span><br><span class="line">`first_name` varchar(14) NOT NULL,</span><br><span class="line">`last_name` varchar(16) NOT NULL,</span><br><span class="line">`gender` char(1) NOT NULL,</span><br><span class="line">`hire_date` date NOT NULL,</span><br><span class="line">PRIMARY KEY (`emp_no`));</span><br><span class="line"></span><br><span class="line">解：</span><br><span class="line">select e.last_name,e.first_name,d.dept_no</span><br><span class="line">from employees as e left join dept_emp as d</span><br><span class="line">on e.emp_no = d.emp_no</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://www.cnblogs.com/leochenliang/p/7364665.html（left" target="_blank" rel="noopener">https://www.cnblogs.com/leochenliang/p/7364665.html（left</a> join on and 与 left join on where的区别）</p>
</blockquote>
<h4 id="关于NULL值"><a href="#关于NULL值" class="headerlink" title="关于NULL值"></a>关于NULL值</h4><p>运算符操作：</p>
<ul>
<li>IS NULL: 当列的值是 NULL,此运算符返回 true。</li>
<li>IS NOT NULL: 当列的值不为 NULL, 运算符返回 true。</li>
<li>&lt;=&gt;: 比较操作符（不同于=运算符），当比较的的两个值为 NULL 时返回 true。</li>
</ul>
<p>&ensp;&ensp;关于 NULL 的条件比较运算是比较特殊的。你不能使用 = NULL 或 != NULL 在列中查找 NULL 值 。在 MySQL 中，NULL 值与任何其它值的比较（即使是 NULL）永远返回 false，即 NULL = NULL 返回false 。MySQL 中处理 NULL 使用 IS NULL 和 IS NOT NULL 运算符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * , columnName1 + ifnull(columnName2,0) from tableName;</span><br><span class="line">columnName1，columnName2 为 int 型，当 columnName2 中，有值为 null 时，columnName1+columnName2=null， ifnull(columnName2,0) 把 columnName2 中 null 值转为 0。</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;下面为一个left jion 与 null值判断的组合使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">获取所有非manager的员工emp_no</span><br><span class="line">CREATE TABLE `dept_manager` (</span><br><span class="line">`dept_no` char(4) NOT NULL,</span><br><span class="line">`emp_no` int(11) NOT NULL,</span><br><span class="line">`from_date` date NOT NULL,</span><br><span class="line">`to_date` date NOT NULL,</span><br><span class="line">PRIMARY KEY (`emp_no`,`dept_no`));</span><br><span class="line">CREATE TABLE `employees` (</span><br><span class="line">`emp_no` int(11) NOT NULL,</span><br><span class="line">`birth_date` date NOT NULL,</span><br><span class="line">`first_name` varchar(14) NOT NULL,</span><br><span class="line">`last_name` varchar(16) NOT NULL,</span><br><span class="line">`gender` char(1) NOT NULL,</span><br><span class="line">`hire_date` date NOT NULL,</span><br><span class="line">PRIMARY KEY (`emp_no`));</span><br><span class="line"></span><br><span class="line">解：先使用LEFT JOIN连接两张表，再从此表中选出dept_no值为NULL对应的emp_no记录</span><br><span class="line">select e.emp_no</span><br><span class="line">from employees e left join dept_manager d</span><br><span class="line">on e.emp_no = d.emp_no</span><br><span class="line">where d.emp_no is null;</span><br></pre></td></tr></table></figure>
<h4 id="ALTER"><a href="#ALTER" class="headerlink" title="ALTER"></a>ALTER</h4><p>&ensp;&ensp;修改数据表名或者修改数据表字段时，需要使用到MySQL ALTER命令</p>
<h5 id="1-删除，添加或修改表字段"><a href="#1-删除，添加或修改表字段" class="headerlink" title="1.删除，添加或修改表字段"></a>1.删除，添加或修改表字段</h5><p>&ensp;&ensp;如果数据表中只剩余一个字段则无法使用DROP来删除字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe dsq_table;</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| dsq_id | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(100)     | NO   |     | NULL    |                |</span><br><span class="line">| name   | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| sex    | varchar(10)      | NO   |     | NULL    |                |</span><br><span class="line">| date   | date             | YES  |     | NULL    |                |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table dsq_table drop sex;</span><br><span class="line">Query OK, 0 rows affected (0.56 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_table;</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| dsq_id | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(100)     | NO   |     | NULL    |                |</span><br><span class="line">| name   | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| date   | date             | YES  |     | NULL    |                |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;添加列，并定义字段数据类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table dsq_table add sex varchar(5);</span><br><span class="line">Query OK, 0 rows affected (0.28 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_table;</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| dsq_id | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(100)     | NO   |     | NULL    |                |</span><br><span class="line">| name   | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| date   | date             | YES  |     | NULL    |                |</span><br><span class="line">| sex    | varchar(5)       | YES  |     | NULL    |                |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如果需要指定新增字段的位置，可以使用MySQL提供的关键字 FIRST (设定位第一列)， AFTER 字段名（设定位于某个字段之后）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table dsq_table add hobby varchar(100) after name;</span><br><span class="line">Query OK, 0 rows affected (0.28 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_table;</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">| dsq_id | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(100)     | NO   |     | NULL    |                |</span><br><span class="line">| name   | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| hobby  | varchar(100)     | YES  |     | NULL    |                |</span><br><span class="line">| date   | date             | YES  |     | NULL    |                |</span><br><span class="line">| sex    | varchar(5)       | YES  |     | NULL    |                |</span><br><span class="line">+--------+------------------+------+-----+---------+----------------+</span><br><span class="line">6 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h5 id="2-修改字段类型及名称"><a href="#2-修改字段类型及名称" class="headerlink" title="2.修改字段类型及名称"></a>2.修改字段类型及名称</h5><p>如果需要修改字段类型及名称, 你可以在ALTER命令中使用 MODIFY 或 CHANGE 子句<br>语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE testalter_tbl MODIFY c CHAR(10); #把字段 c 的类型从 CHAR(1) 改为 CHAR(10)</span><br><span class="line">ALTER TABLE testalter_tbl CHANGE j i INT;    #把字段 j 的名称变为 i ，类型为 INT</span><br></pre></td></tr></table></figure>
<h5 id="3-关于Null-值和默认值"><a href="#3-关于Null-值和默认值" class="headerlink" title="3.关于Null 值和默认值"></a>3.关于Null 值和默认值</h5><p>&ensp;&ensp;如果不设置默认值，MySQL会自动设置该字段默认为 NULL，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe dsq_tbl;</span><br><span class="line">+--------+----------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type                 | Null | Key | Default | Extra          |</span><br><span class="line">+--------+----------------------+------+-----+---------+----------------+</span><br><span class="line">| id     | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| title  | varchar(20)          | YES  |     | NULL    |                |</span><br><span class="line">| author | varchar(20)          | YES  |     | NULL    |                |</span><br><span class="line">| date   | date                 | YES  |     | NULL    |                |</span><br><span class="line">+--------+----------------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;当进行修改字段时，可以指定是否包含值或者是否设置默认值。需要设置not null ，默认值才会有效。语法为  ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE tablename </span><br><span class="line">    -&gt; MODIFY col_name column_definition NOT NULL DEFAULT ***;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如下，将字段date 默认值更改为当前日期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table dsq_tbl modify date timestamp not null default CURRENT_timestamp;</span><br><span class="line">Query OK, 8 rows affected (0.34 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_tbl;</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field  | Type                 | Null | Key | Default           | Extra          |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| id     | smallint(5) unsigned | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| title  | varchar(20)          | YES  |     | NULL              |                |</span><br><span class="line">| author | varchar(20)          | YES  |     | NULL              |                |</span><br><span class="line">| date   | timestamp            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="4-修改字段默认值"><a href="#4-修改字段默认值" class="headerlink" title="4.修改字段默认值"></a>4.修改字段默认值</h5><p>语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER  TABLE tbl_name  ALTER  col_name &#123;SET DEFAULT literal | DROP DEFAULT&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table dsq_tbl alter author set default 10;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_tbl;</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field  | Type                 | Null | Key | Default           | Extra          |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| id     | smallint(5) unsigned | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| title  | varchar(20)          | YES  |     | NULL              |                |</span><br><span class="line">| author | varchar(20)          | YES  |     | 10                |                |</span><br><span class="line">| date   | timestamp            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table dsq_tbl alter author drop default;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe dsq_tbl;</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field  | Type                 | Null | Key | Default           | Extra          |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">| id     | smallint(5) unsigned | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| title  | varchar(20)          | YES  |     | NULL              |                |</span><br><span class="line">| author | varchar(20)          | YES  |     | NULL              |                |</span><br><span class="line">| date   | timestamp            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+--------+----------------------+------+-----+-------------------+----------------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h5 id="5-修改表名"><a href="#5-修改表名" class="headerlink" title="5.修改表名"></a>5.修改表名</h5><p>&ensp;&ensp;如果需要修改表名，可以在 ALTER TABLE 语句中使用 RENAME 子句 ，或者RENAME TABLE语句</p>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE</span><br><span class="line">    tbl_name TO new_tbl_name</span><br><span class="line">    [, tbl_name2 TO new_tbl_name2] ...</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;RENAME TABLE重命名一个或多个表。但是必须具有ALTER与 DROP原始表的权限，以及CREATE与 INSERT新表的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE old_table TO new_table;</span><br><span class="line">等价于</span><br><span class="line">ALTER TABLE old_table RENAME new_table;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;RENAME TABLE 与 ALTER TABLE 的不同在于，RENAME TABLE 可以在一个语句中重命名多个表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交换两个表的名称</span><br><span class="line">RENAME TABLE old_table TO tmp_table,</span><br><span class="line">             new_table TO old_table,</span><br><span class="line">             tmp_table TO new_table；</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;使用RENAME TABLE将表从一个数据库移动到另一个数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE current_db.tbl_name TO other_db.tbl_name;</span><br></pre></td></tr></table></figure>
<h4 id="表的显示"><a href="#表的显示" class="headerlink" title="表的显示"></a>表的显示</h4><p>在进入MYSQL时，提示的第二行有这样一句话” Commands end with ; or \g.”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from dsq_table \g</span><br><span class="line">+--------+--------+------+-------+------------+------+</span><br><span class="line">| dsq_id | title  | name | hobby | date       | sex  |</span><br><span class="line">+--------+--------+------+-------+------------+------+</span><br><span class="line">|      2 | play   | zxc  | NULL  | 2000-01-01 | NULL |</span><br><span class="line">|      3 | netlab | dsq  | NULL  | 2019-03-25 | NULL |</span><br><span class="line">|      4 | netlab | dsq  | NULL  | 2019-03-25 | NULL |</span><br><span class="line">+--------+--------+------+-------+------------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">使用 \G 是垂直显示结果(ego       (\G) Send command to mysql server, display result vertically.)。</span><br><span class="line">mysql&gt; select * from dsq_table \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">dsq_id: 2</span><br><span class="line"> title: play</span><br><span class="line">  name: zxc</span><br><span class="line"> hobby: NULL</span><br><span class="line">  date: 2000-01-01</span><br><span class="line">   sex: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">dsq_id: 3</span><br><span class="line"> title: netlab</span><br><span class="line">  name: dsq</span><br><span class="line"> hobby: NULL</span><br><span class="line">  date: 2019-03-25</span><br><span class="line">   sex: NULL</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">dsq_id: 4</span><br><span class="line"> title: netlab</span><br><span class="line">  name: dsq</span><br><span class="line"> hobby: NULL</span><br><span class="line">  date: 2019-03-25</span><br><span class="line">   sex: NULL</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/29/MySQL建库建表、数据插入/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/29/MySQL建库建表、数据插入/" itemprop="url">MySQL建库建表、数据插入</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-29T18:33:19+08:00">
                2019-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="连接与断开服务器"><a href="#连接与断开服务器" class="headerlink" title="连接与断开服务器"></a>连接与断开服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study var]#   mysql --host=hostname  --user=user  --password</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 37</span><br><span class="line">Server version: 5.6.43 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="输入查询"><a href="#输入查询" class="headerlink" title="输入查询"></a>输入查询</h3><p>&ensp;&ensp;介绍几个输入查询的基本原则来熟悉mysql的工作原理。<br>&ensp;&ensp;这是一个简单的查询，要求服务器说明它的版本号和当前日期。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  SELECT VERSION(), CURRENT_DATE;</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| VERSION() | CURRENT_DATE |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 5.6.43    | 2019-02-18   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;关键字可以输入任何字母。以下查询是等效的，即不区分大小写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT VERSION(), CURRENT_DATE;</span><br><span class="line">mysql&gt; select version(), current_date;</span><br><span class="line">mysql&gt; SeLeCt vErSiOn(), current_DATE;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;这是另一个查询。它演示了您可以将 mysql用作简单的计算器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT SIN(PI()/4), (4+1)*5;</span><br><span class="line">+------------------+---------+</span><br><span class="line">| SIN(PI()/4)      | (4+1)*5 |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| 0.70710678118655 |      25 |</span><br><span class="line">+------------------+---------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;到目前为止显示的查询是相对较短的单行语句。也可以在一行中输入多个语句。用分号结束每一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT VERSION(); SELECT NOW();</span><br><span class="line">+-----------+</span><br><span class="line">| VERSION() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.6.43    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">+---------------------+</span><br><span class="line">| NOW()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2019-02-18 11:01:14 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;多行的冗长查询不是问题,mysql通过查找终止分号来确定语句的结束位置，而不是查找输入行的结尾。<br>这是一个简单的多行语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; user()</span><br><span class="line">    -&gt; ,</span><br><span class="line">    -&gt; current_date;</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| user()         | current_date |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| web@172.19.0.3 | 2019-02-18   |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如果决定不想执行正在输入的查询，请键入\c以下命令取消它 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT</span><br><span class="line">    -&gt; USER()</span><br><span class="line">    -&gt; \c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;在这里，也请注意提示。它会mysql&gt;在键入后切换回来 \c，提供反馈以指示mysql已为新查询做好准备。<br>&ensp;&ensp;下表显示了可能看到的每个提示，并总结了它们对mysql所处状态的含义 。</p>
<table>
<thead>
<tr>
<th style="text-align:center">提示</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">mysql&gt;</td>
<td style="text-align:center">准备好进行新查询</td>
</tr>
<tr>
<td style="text-align:center">-&gt;</td>
<td style="text-align:center">等待下一行的多行查询</td>
</tr>
<tr>
<td style="text-align:center">‘&gt;</td>
<td style="text-align:center">等待下一行，以单引号（’）开头的字符串</td>
</tr>
<tr>
<td style="text-align:center">“&gt;</td>
<td style="text-align:center">等待下一行，以双引号开头的字符串（”）</td>
</tr>
<tr>
<td style="text-align:center">`&gt;</td>
<td style="text-align:center">等待下一行，以反引号（`）开头的标识符</td>
</tr>
<tr>
<td style="text-align:center">/*&gt;</td>
<td style="text-align:center">等待下一行，以/*开头的描述</td>
</tr>
</tbody>
</table>
<p>&ensp;&ensp;在MySQL中，可以编写由任一字符’或”字符包括的字符串（例如’hello’或”goodbye”),并且 mysql允许输入跨越多行的字符串。看到’&gt;或 “&gt;提示时，表示输入的行包含以a ‘ 或”quote字符开头的字符串，但没有输入终止字符串的匹配引号。这通常表明遗漏了引号字符。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name = &apos;Smith AND age &lt; 30;</span><br><span class="line">    &apos;&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;通过转义字符取消查询，如果只输入\c，会被认为是引号内的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name = &apos;Smith AND age &lt; 30;</span><br><span class="line">    &apos;&gt; &apos;\c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;`&gt;提示类似于 ‘&gt;和”&gt;提示，但表示你已经开始但尚未完成反引号引用的标识符。</p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE 16netlab;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;在Unix下，数据库名称是区分大小写的（不像SQL关键字）。表名也是如此。（在Windows下，此限制不适用，但必须在给定查询中使用相同的字母表引用数据库和表。但是，出于各种原因，建议的最佳做法始终是使用相同字母。）<br><strong>注意</strong>  </p>
<ul>
<li>如果收到错误  ERROR 1044（42000）：ERROR 1044 (42000): Access denied for user ‘micah‘@’localhost’ to database ‘menagerie’，这意味着用户帐户没有必要的权限。  </li>
</ul>
<p>&ensp;&ensp;要使16netlab为当前数据库，请使用以下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use 16netlab;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;数据库只需创建一次，但每次开始mysql 会话时都必须选择它才能使用。通过如上所示的语句来完成此操作。或者可以在调用mysql时在命令行上选择数据库。需要提供的所有连接参数之后指定其名称。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker exec -it web mysql -h mysql2 -u web -p 16netlab</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 348</span><br><span class="line">Server version: 5.6.43 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp; <strong>SELECT DATABASE()</strong> 查看当前选择使用哪个数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT DATABASE();</span><br><span class="line">+------------+</span><br><span class="line">| DATABASE() |</span><br><span class="line">+------------+</span><br><span class="line">| 16netlab   |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>&ensp;&ensp;创建数据库很容易，但此时它是空的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW TABLES;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;更难的部分是决定数据库的结构应该是什么：需要哪些表以及每个表中应该包含哪些列。<br>&ensp;&ensp;例如一张包含每只宠物记录的表格。这可以称为pet表格，它应该包含每个动物名称以及长度限制值。如果家中有多个人饲养宠物，列出每只动物的主人，记录一些基本的描述性信息，如物种和性别，年龄。随着时间的推移，年龄会发生变化，这意味着必须经常更新记录。相反，最好存储固定值，如出生日期。如果需要年龄，可以将其计算为当前日期和出生日期之间的差异。MySQL提供了进行日期算术的功能。</p>
<p>&ensp;&ensp;你可能会想到在pet表格中有用的其他类型的信息，但到目前为止确定的信息是足够的：名称，所有者，物种，性别，出生和死亡日期。<br>&ensp;&ensp;使用<strong>CREATE TABLE</strong>语句指定表的布局：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),</span><br><span class="line">    -&gt; species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;VARCHAR数据类型对于name、 owner和species 列是不错的选择，因为列值的长度不同。定义列的长度时根据实际情况合理选择。通常，可以选择1-65535中的任何长度。</p>
<p>&ensp;&ensp;可以选择几种类型的值来表示动物记录中的性别，例如’m’和 ‘f’，或者可能’male’和 ‘female’。最简单的是使用单个字符’m’和’f’。<br>DATE对于birth和death 列 使用数据类型是一个相当明显的选择。<br>&ensp;&ensp;创建表后，<strong>SHOW TABLES</strong>应该产生一些输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW TABLES;</span><br><span class="line">+--------------------+</span><br><span class="line">| Tables_in_16netlab |</span><br><span class="line">+--------------------+</span><br><span class="line">| pet                |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;要验证表是否按预期方式创建，使用<strong>DESCRIBE</strong>语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe pet;</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| owner   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| species | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| sex     | char(1)     | YES  |     | NULL    |       |</span><br><span class="line">| birth   | date        | YES  |     | NULL    |       |</span><br><span class="line">| death   | date        | YES  |     | NULL    |       |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="添加数据到表"><a href="#添加数据到表" class="headerlink" title="添加数据到表"></a>添加数据到表</h3><p>&ensp;&ensp;创建表后需要填充它。使用<strong>LOAD DATA</strong>和 <strong>INSERT</strong>语句<br>&ensp;&ensp;假设宠物记录可以如此处所示。</p>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">主人</th>
<th style="text-align:center">种类</th>
<th style="text-align:center">性别</th>
<th style="text-align:center">出生日期</th>
<th style="text-align:center">死亡日期</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fluffy</td>
<td style="text-align:center">Harold</td>
<td style="text-align:center">cat</td>
<td style="text-align:center">f</td>
<td style="text-align:center">1993-02-04</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Claws</td>
<td style="text-align:center">Gwen</td>
<td style="text-align:center">cat</td>
<td style="text-align:center">m</td>
<td style="text-align:center">1994-03-17</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Buffy</td>
<td style="text-align:center">Harold</td>
<td style="text-align:center">dog</td>
<td style="text-align:center">f</td>
<td style="text-align:center">1989-05-13</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Fang</td>
<td style="text-align:center">Benny</td>
<td style="text-align:center">dog</td>
<td style="text-align:center">m</td>
<td style="text-align:center">1990-08-27</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Bowser</td>
<td style="text-align:center">Diane</td>
<td style="text-align:center">dog</td>
<td style="text-align:center">m</td>
<td style="text-align:center">1979-08-31</td>
<td style="text-align:center">1995-07-29</td>
</tr>
<tr>
<td style="text-align:center">Chirpy</td>
<td style="text-align:center">Gwen</td>
<td style="text-align:center">bird</td>
<td style="text-align:center">f</td>
<td style="text-align:center">1998-09-11</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Whistler</td>
<td style="text-align:center">Gwen</td>
<td style="text-align:center">bird</td>
<td style="text-align:center"></td>
<td style="text-align:center">1997-12-09</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Slim</td>
<td style="text-align:center">Benny</td>
<td style="text-align:center">snake</td>
<td style="text-align:center">m</td>
<td style="text-align:center">1996-04-29</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>&ensp;&ensp;因为从空表开始，所以填充它的一种简单方法是为每个动物创建一个包含行的文本文件，然后使用单个语句将文件内容加载到表中。</p>
<p>&ensp;&ensp;可以创建一个文本文件pet.txt，每行包含一个记录，其值由制表符分隔，并按照<strong>CREATE TABLE</strong>语句中列出的顺序给出 。对于缺失值（例如未知性别或仍然生活的动物的死亡日期），可以使用NULL 值。要在文本文件中表示这些，请使用 \N（反斜杠，大写-N）。例如，惠斯勒鸟的记录看起来像这样（值之间的空格是单个制表符）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Whistler        Gwen    bird    \N      1997-12-09      \N</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;要将文本文件加载pet.txt到 pet表中，请使用以下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; LOAD DATA LOCAL INFILE &apos;/path/pet.txt&apos; INTO TABLE pet;</span><br></pre></td></tr></table></figure>
<p>&ensp;&ensp;如果需要，可以在<strong>LOAD DATA</strong>语句中显式指定列值分隔符和行结束标记，但默认值为制表符和换行符。这些语句正确读取pet.txt。  </p>
<p>&ensp;&ensp;如果语句失败，则默认情况下MySQL安装可能没有启用本地文件功能。  </p>
<p>&ensp;&ensp;如果要一次添加一条新记录，该 INSERT语句很有用。在最简单的形式中，按照CREATE TABLE语句中列出的列的顺序为每列提供值 。假设黛安得到了一只名为“ Puffball ”的仓鼠。可以使用如下<strong>INSERT</strong>语句添加 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO pet</span><br><span class="line">       VALUES (&apos;Puffball&apos;,&apos;Diane&apos;,&apos;hamster&apos;,&apos;f&apos;,&apos;1999-03-30&apos;,NULL);</span><br><span class="line">字符串和日期值在此处指定为带引号的字符串。此外，可以直接插入NULL 以表示缺失值。</span><br><span class="line">mysql&gt; INSERT INTO pet</span><br><span class="line">    -&gt;  VALUES (&apos;Fluffy&apos;,&apos;Harold&apos;,&apos;cat&apos;,&apos;f&apos;,&apos;1999-02-04&apos;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO pet  VALUES (&apos;Claws&apos;,&apos;Gwen&apos;,&apos;cat&apos;,&apos;m&apos;,&apos;1994-03-17&apos;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO pet  VALUES (&apos;Buffy&apos;,&apos;Harold&apos;,&apos;dog&apos;,&apos;f&apos;,&apos;1989-05-13&apos;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO pet  VALUES (&apos;Fang&apos;,&apos;Benny&apos;,&apos;dog&apos;,&apos;m&apos;,&apos;1990-08-27&apos;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO pet  VALUES (&apos;Bowser&apos;,&apos;Diane&apos;,&apos;dog&apos;,&apos;m&apos;,&apos;1979-08-31&apos;,&apos;1995-07-29&apos;);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO pet  VALUES (&apos;Chirpy&apos;,&apos;Genw&apos;,&apos;bird&apos;,&apos;f&apos;,&apos;1998-09-11&apos;,null);</span><br><span class="line">Query OK, 1 row affected (0.42 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM pet;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1999-02-04 | NULL       |</span><br><span class="line">| Claws  | Gwen   | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Fang   | Benny  | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">| Chirpy | Genw   | bird    | f    | 1998-09-11 | NULL       |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/25/使用Docker在linux上部署MySQL/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/使用Docker在linux上部署MySQL/" itemprop="url">使用Docker在linux上部署MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-25T12:17:46+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="下载MySQL服务器Docker镜像"><a href="#下载MySQL服务器Docker镜像" class="headerlink" title="下载MySQL服务器Docker镜像"></a>下载MySQL服务器Docker镜像</h3><p>使用命令下载MYSQL-Community：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql/mysql-server:tag</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;tag是你想拉的镜像版本的标签（例如5.5， 5.6，5.7， 8.0，或latest）。如果省略则会下载最新GA版本的MySQL-community-server的镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker pull mysql/mysql-server:5.6</span><br><span class="line">5.6: Pulling from mysql/mysql-server</span><br><span class="line">a8d84c1f755a: Pull complete </span><br><span class="line">36934cee5f0d: Pull complete </span><br><span class="line">5a6871e55c04: Pull complete </span><br><span class="line">7c67030deb6e: Pull complete </span><br><span class="line">Digest: sha256:5a1cfc50ab8d147cb163c32558c7334519f5bb69ea82587d480f9f7050b77047</span><br><span class="line">Status: Downloaded newer image for mysql/mysql-server:5.6</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;使用以下命令列出下载的Docker镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker image ls</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mysql/mysql-server              5.6                 ad62049ce4ab        6 weeks ago         217MB</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<h3 id="启动MySQL服务器实例"><a href="#启动MySQL服务器实例" class="headerlink" title="启动MySQL服务器实例"></a>启动MySQL服务器实例</h3><p>&nbsp;&nbsp;&nbsp;将MySQL镜像启动为容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker run --name=mysql1 -d mysql/mysql-server:5.6</span><br><span class="line">321d33b946e7eb8ebea4fe829d1cfb953c6dd5663021088fb9cff21bcea2a112</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–name用于为容器提供自定义名称，该选项是可选的;，如果没有提供容器名称，则生成随机的名称。如果先前的docker pull或docker run 命令未下载指定名称和标记的镜像， 则现在下载该图像。下载完成后，开始初始化容器，并在运行docker ps命令时容器显示在正在运行的容器列表中 ; 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker container ls</span><br><span class="line">CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS                             PORTS                       NAMES</span><br><span class="line">321d33b946e7        mysql/mysql-server:5.6               &quot;/entrypoint.sh mysq…&quot;   3 minutes ago       Up 3 minutes (healthy)             3306/tcp                    mysql1</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;初始化完成后，命令的输出将包含为root用户生成的随机密码; 例如，使用以下命令检查密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker logs mysql1 2&gt;&amp;1 | grep GENERATED</span><br><span class="line">[Entrypoint] GENERATED ROOT PASSWORD: mOkuHorEKBEh4plym@KYsXYk%Ih</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<h3 id="连接到Container内的MySQL服务器"><a href="#连接到Container内的MySQL服务器" class="headerlink" title="连接到Container内的MySQL服务器"></a>连接到Container内的MySQL服务器</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;服务器准备就绪后，可以在刚刚启动的MySQL Server容器中运行 mysql客户端，并将其连接到MySQL服务器。使用<strong>docker exec -it</strong>命令在已启动的Docker容器中进入 mysql客户端，输入生成的root密码。因为<strong>MYSQL_ONETIME_PASSWORD</strong> 默认情况下该选项为true，所以在将mysql客户端连接 到服务器之后，重置服务器root密码，如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker exec -it mysql1 mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 50</span><br><span class="line">Server version: 5.6.43</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;  SET PASSWORD FOR &apos;root&apos;@&apos;localhost&apos; = PASSWORD(&apos;123456&apos;);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="容器shell访问"><a href="#容器shell访问" class="headerlink" title="容器shell访问"></a>容器shell访问</h3><p>&nbsp;&nbsp;&nbsp;要使用shell访问MySQL Server容器，请使用 docker exec -it命令在容器内启动bash shell：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker exec -it mysql1 bash</span><br><span class="line">bash-4.2#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;然后可以在容器内运行Linux命令。例如，要查看容器内server数据目录中的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2# ls /var/lib/mysql</span><br><span class="line">auto.cnf  ib_logfile0  ib_logfile1  ibdata1  mysql  mysql.sock  performance_schema  test</span><br><span class="line">bash-4.2#</span><br></pre></td></tr></table></figure>
<h3 id="停止和删除MySQL容器"><a href="#停止和删除MySQL容器" class="headerlink" title="停止和删除MySQL容器"></a>停止和删除MySQL容器</h3><p>&nbsp;&nbsp;&nbsp;使用以下命令停止创建的MySQL Server容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker stop mysql1</span><br><span class="line">mysql1</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;docker stop向 mysqld进程发送SIGTERM信号 ，以便正常关闭服务器。  </p>
<p>&nbsp;&nbsp;&nbsp;另请注意，当容器的主进程（MySQL服务器容器中的mysqld）停止时，Docker容器会自动停止。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">要再次启动MySQL Server容器：</span><br><span class="line">docker start mysql1</span><br><span class="line"></span><br><span class="line">使用单个命令停止并重新启动MySQL Server容器：</span><br><span class="line">docker restart mysql1</span><br><span class="line"></span><br><span class="line">要删除MySQL容器，请先将其停止，然后使用 docker rm命令：</span><br><span class="line">docker stop mysql1</span><br><span class="line">docker rm mysql1</span><br><span class="line"></span><br><span class="line">如果希望同时删除服务器数据目录的 Docker卷，请将该-v选项添加到 docker rm命令。</span><br><span class="line">docker rm -v mysql1</span><br></pre></td></tr></table></figure>
<h3 id="配置MySQL服务器"><a href="#配置MySQL服务器" class="headerlink" title="配置MySQL服务器"></a>配置MySQL服务器</h3><p>&nbsp;&nbsp;&nbsp;启动MySQL Docker容器时，可以通过docker run命令将配置选项传递给服务器; 例如，对于MySQL服务器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker run --name mysql1 -d mysql/mysql-server:5.6 --character-set-server=utf8mb4 --collation-server=utf8mb4_col</span><br><span class="line">ae491dde8ad07c8db420facc6a7b6546b3ae375d7e37430e4a01a6b4c34913f3</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;该命令启动MySQL服务器 utf8mb4作为默认字符集和 utf8mb4_col数据库的默认排序规则。  </p>
<p>&nbsp;&nbsp;&nbsp;配置MySQL服务器的另一种方法是准备配置文件并将其安装在容器内的服务器配置文件的位置。</p>
<h3 id="持久化数据和配置更改"><a href="#持久化数据和配置更改" class="headerlink" title="持久化数据和配置更改"></a>持久化数据和配置更改</h3><p>&nbsp;&nbsp;&nbsp;Docker容器原则上是短暂的，如果容器被删除或损坏，预计会丢失任何数据或配置。 但是，Docker卷提供了一种机制来保存在Docker容器中创建的数据。在初始化时，MySQL Server容器为服务器数据目录创建一个Docker卷。在容器上运行docker inspect命令的JSON输出有一个 Mount键，其值提供有关数据目录卷的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker inspect mysql1</span><br><span class="line">[</span><br><span class="line">…………</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;4ae57cb3823bf75c18b2212530fee42bc7d851446a5fee48406542c04df62221&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/4ae57cb3823bf75c18b2212530fee42bc7d851446a5fee48406542c04df62221/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/var/lib/mysql&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],…………</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;输出显示/var/lib/docker/volumes/4ae57cb3823bf75c18b2212530fee42bc7d<br>851446a5fee48406542c04df62221/_data主机文件夹（主机上持有数据）已安装在 /var/lib/mysql容器内的服务器数据目录中。  </p>
<p>&nbsp;&nbsp;&nbsp;保留数据的另一种方法是 在创建容器时 使用–mount绑定安装主机目录。可以使用相同的技术来持久保存服务器的配置。以下命令创建MySQL Server容器并绑定安装数据目录和服务器配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]#  ls</span><br><span class="line">anaconda-ks.cfg  datadir  docker  initial-setup-ks.cfg  my.cnf  src</span><br><span class="line">[root@docker-study ~]# cat my.cnf </span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket = /usr/local/mysql/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /var/lib/mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket = /usr/local/mysql/mysql.sock</span><br><span class="line">character-set-server=utf8</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">[root@docker-study ~]# docker run --name=mysql1 \</span><br><span class="line">--mount type=bind,src=/root/my.cnf,dst=/etc/my.cnf \</span><br><span class="line">--mount type=bind,src=/root/datadir,dst=/var/lib/mysql \</span><br><span class="line">-d mysql/mysql-server:5.6</span><br><span class="line">58d707e7a9f75b38516d17dc54ee3685e00052969c01c887b40f0ac8f819a936</span><br><span class="line">[root@docker-study ~]# ls datadir/</span><br><span class="line">ibdata1  ib_logfile0  ib_logfile1  mysql  performance_schema  test</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;安装 path-on-host-machine/my.cnf 到/etc/my.cnf（容器内部的配置文件），同时 path-on-host-machine/datadir 到/var/lib/mysql（数据容器内的目录）。必须满足以下条件才能使绑定安装正常工作：  </p>
<p>&nbsp;&nbsp;&nbsp;配置文件 path-on-host-machine/my.cnf 必须已存在，并且必须包含使用用户启动mysql服务器的规范：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">…………</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;数据目录 path-on-host-machine/datadir 必须已存在。要进行服务器初始化，目录必须为空。还可以安装预先填充数据的目录并启动服务器; 但是必须确保使用与创建数据的服务器相同的配置来启动Docker容器，并在启动容器时装入所需的任何主机文件或目录。</p>
<h3 id="运行其他初始化脚本"><a href="#运行其他初始化脚本" class="headerlink" title="运行其他初始化脚本"></a>运行其他初始化脚本</h3><p>如果在创建数据库后立即要在数据库上运行任何.sh或 .sql脚本，则可以将它们放入主机目录，然后将目录 /docker-entrypoint-initdb.d/挂载在容器内部。例如，对于MySQL Server容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=mysql1 \</span><br><span class="line">--mount type=bind,src=/path-on-host-machine/scripts/,dst=/docker-entrypoint-initdb.d/ \</span><br><span class="line">-d mysql/mysql-server:tag</span><br></pre></td></tr></table></figure>
<h3 id="从另一个Docker容器中的应用程序连接到MySQL"><a href="#从另一个Docker容器中的应用程序连接到MySQL" class="headerlink" title="从另一个Docker容器中的应用程序连接到MySQL"></a>从另一个Docker容器中的应用程序连接到MySQL</h3><p>&nbsp;&nbsp;&nbsp;通过设置Docker网络，您可以允许多个Docker容器相互通信，以便另一个Docker容器中的客户端应用程序可以访问服务器容器中的MySQL Server。首先，创建一个Docker网络：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker network create my-custom-net</span><br><span class="line">e78c79012d0e865acc06f043f03e9a900a5a478780fc0d7fb30a82ae0c644303</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;然后，在创建和启动服务器和客户端容器时，使用该–network选项将它们放在您创建的网络上。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study ~]# docker run --name=mysql2 --network=my-custom-net -d mysql/mysql-server:5.6</span><br><span class="line">80415ae4ba16a3e89f3b7afc5d1f4ffde028fc65a66ff7f03810828070e6a17f</span><br><span class="line">[root@docker-study ~]# docker run --name=web --network=my-custom-net -d  httpd</span><br><span class="line">264833168ac671eda95d0dd10547ce9bfa18bf83bc97531f85de202f72886088</span><br><span class="line">[root@docker-study ~]#</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;在mysql容器中设置web用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create user web@172.19.0.3 identified by &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;  grant all privileges on *.* to web@172.19.0.3;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;然后，web容器可以使用mysql2主机名连接到mysql2容器， 反之亦然，因为Docker会自动为给定的容器名称设置DNS。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-study var]# docker exec -it web  mysql --host=mysql2 --user=web --password</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 37</span><br><span class="line">Server version: 5.6.43 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="服务器错误日志"><a href="#服务器错误日志" class="headerlink" title="服务器错误日志"></a>服务器错误日志</h3><p>&nbsp;&nbsp;&nbsp;首次使用服务器容器启动MySQL服务器时， 如果满足以下任一条件，则不会生成服务器错误日志：</p>
<ul>
<li>已装入主机的服务器配置文件，但该文件不包含系统变量 log_error。</li>
<li>尚未安装主机的服务器配置文件，但Docker环境变量 MYSQL_LOG_CONSOLE 是true（MySQL 5.6服务器容器的变量的默认状态false）。然后将MySQL服务器的错误日志重定向到 stderr，以便错误日志进入Docker容器的日志，并使用docker logs mysqld-container 命令查看 。  </li>
</ul>
<p>&nbsp;&nbsp;&nbsp;要使MySQL Server在两个条件之一为真时生成错误日志，请使用该 –log-error 选项 ，配置服务器以在容器内的特定位置生成错误日志。要保留错误日志，请将主机文件挂载到容器内错误日志的位置，如上文中所述。但是必须确保其容器内的MySQL Server具有对挂载的主机文件有写访问权。</p>
<h3 id="Docker环境变量"><a href="#Docker环境变量" class="headerlink" title="Docker环境变量"></a>Docker环境变量</h3><p>&nbsp;&nbsp;&nbsp;创建MySQL Server容器时，可以使用–env选项（-e简而言之）配置MySQL实例，并指定以下一个或多个环境变量。</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>&nbsp;&nbsp;&nbsp;如果挂载的数据目录不为空，则以下变量都不会产生任何影响，因为之后不会尝试进行服务器初始化。在容器启动期间，不会修改文件夹中任何预先存在的内容，包括任何旧服务器设置。</p>
<p>&nbsp;&nbsp;&nbsp;布尔变量包括 MYSQL_RANDOM_ROOT_PASSWORD, MYSQL_ONETIME_PASSWORD和MYSQL_ALLOW_EMPTY_PASSWORD， MYSQL_LOG_CONSOLE 通过使用任何非零长度的字符串设置它们来实现。<br>例如”0”，”false”或 “no”不会使它们为假，但实际上使它们成立。这是MySQL Server容器的已知问题。</p>
<ul>
<li>MYSQL_RANDOM_ROOT_PASSWORD：当此变量为true（这是默认状态，除非 MYSQL_ROOT_PASSWORD 或MYSQL_ALLOW_EMPTY_PASSWORD 设置为true）时，将在启动Docker容器时生成服务器root用户的随机密码。密码打印到stdout容器中，可以通过查看容器的日志找到。</li>
<li>MYSQL_ONETIME_PASSWORD：当变量为true（这是默认状态，除非 MYSQL_ROOT_PASSWORD 已设置或MYSQL_ALLOW_EMPTY_PASSWORD 设置为true）时，root用户的密码设置为expired，必须先更改才能正常使用MySQL。</li>
<li>MYSQL_DATABASE：此变量允许指定要在镜像启动时创建的数据库的名称。如果用户名和密码均由 MYSQL_USER 和MYSQL_PASSWORD提供，创建用户并授予该数据库（对应于超级用户权限GRANT ALL）。指定的数据库由 CREATE DATABASE IF NOT EXIST语句创建，因此如果数据库已存在，则该变量无效。</li>
<li>MYSQL_USER， MYSQL_PASSWORD：这些变量结合使用来创建用户并设置该用户的密码，并为该用户授予该MYSQL_DATABASE 变量指定的数据库的超级用户权限 。MYSQL_USER 和 MYSQL_PASSWORD 用于创建用户，如果这两个变量没有设置，则忽略。如果两个变量都已设置但未设置 MYSQL_DATABASE ，则创建用户时没有任何权限。</li>
</ul>
<h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>&nbsp;&nbsp;没有必要使用这种机制创建root用户，这是MYSQL_ROOT_PASSWORD 和 MYSQL_RANDOM_ROOT_PASSWORD两种机制默认创建的，除非 MYSQL_ALLOW_EMPTY_PASSWORD = ture。</p>
<ul>
<li>MYSQL_ROOT_HOST：默认情况下，MySQL会创建 ‘root‘@’localhost’帐户。此帐户只能从容器内部连接。要允许来自其他主机的根连接，请设置此环境变量。例如，该值 为172.17.0.1允许来自运行容器的主机的连接。该选项仅接受一个参数，但允许使用通配符（例如， MYSQL_ROOT_HOST=172.<em>.</em>.*或MYSQL_ROOT_HOST=%）。</li>
<li>MYSQL_LOG_CONSOLE：当变量为true（变量的MySQL 5.6服务器容器的默认状态为false）时，MySQL服务器的错误日志被重定向到 stderr，以便错误日志进入Docker容器的日志，并且可以使用docker logs mysqld-container 命令查看 。  </li>
</ul>
<h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><p>&nbsp;&nbsp;&nbsp;如果已挂载主机的服务器配置文件，则该变量无效。<br>MYSQL_ROOT_PASSWORD：此变量指定为MySQL root帐户设置的密码。</p>
<h4 id="警告"><a href="#警告" class="headerlink" title="警告"></a>警告</h4><p>&nbsp;&nbsp;&nbsp;在命令行上设置MySQL root用户密码是不安全的。作为显式指定密码的替代方法，可以使用容器文件路径为密码文件设置变量，然后从主机中装入包含容器文件路径密码的文件。这仍然不是很安全，因为密码文件的位置仍然暴露。最好使用默认设置， MYSQL_RANDOM_ROOT_PASSWORD=true 并且 MYSQL_ONETIME_PASSWORD=true。</p>
<ul>
<li>MYSQL_ALLOW_EMPTY_PASSWORD。将其设置为true以允许使用root用户的空密码启动容器。  </li>
</ul>
<h4 id="警告-1"><a href="#警告-1" class="headerlink" title="警告"></a>警告</h4><p>&nbsp;&nbsp;&nbsp;将此变量设置为true是不安全的，因为它会使MySQL实例完全不受保护，从而允许任何人获得完整的超级用户访问权限。最好使用默认设置， MYSQL_RANDOM_ROOT_PASSWORD=true 并且MYSQL_ONETIME_PASSWORD=true 。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/MySQL介绍/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/MySQL介绍/" itemprop="url">MySQL介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-23T20:13:18+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.8k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是MySQL"><a href="#什么是MySQL" class="headerlink" title="什么是MySQL"></a>什么是MySQL</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的关系数据库管理系统(RDBMS)应用软件之一。</p>
<h3 id="MySQL数据库是关系型的"><a href="#MySQL数据库是关系型的" class="headerlink" title="MySQL数据库是关系型的"></a>MySQL数据库是关系型的</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;关系数据库将数据存储在单独的表中，而不是将所有数据放在一个大的库房中。数据库结构被组织成针对速度优化的物理文件。逻辑模型具有数据库，表，视图，行和列等对象，可提供灵活的编程环境。可以设置管理不同数据字段之间关系的规则，例如一对一，一对多，唯一，必需或可选，以及不同表之间的”指针”。数据库强制执行这些规则，因此使用设计良好的数据库，应用程序永远不会看到不一致，重复，孤立，过时或丢失的数据。  </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;”MYSQL” 的SQL部分代表 “ 结构化查询语言 ”。SQL是用于访问数据库的最常用的标准化语言。根据编程环境，可以直接输入SQL（例如，生成报告），将SQL语句嵌入到用其他语言编写的代码中，或使用隐藏SQL语法的特定于语言的API。</p>
<h3 id="MySQL数据库服务器非常快速，可靠，可扩展且易于使用"><a href="#MySQL数据库服务器非常快速，可靠，可扩展且易于使用" class="headerlink" title="MySQL数据库服务器非常快速，可靠，可扩展且易于使用"></a>MySQL数据库服务器非常快速，可靠，可扩展且易于使用</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;MySQL Server最初是为了比现有解决方案更快地处理大型数据库而开发的，并且已经成功地在高要求的生产环境中使用了好几年。虽然在不断发展的今天，MySQL服务器提供了丰富而有用的功能集。它的连接性，速度和安全性使MySQL Server非常适合访问Internet上的数据库。</p>
<h3 id="MySQL-Server适用于客户端-服务器或嵌入式系统。"><a href="#MySQL-Server适用于客户端-服务器或嵌入式系统。" class="headerlink" title="MySQL Server适用于客户端/服务器或嵌入式系统。"></a>MySQL Server适用于客户端/服务器或嵌入式系统。</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;MySQL数据库软件是一个C/S系统，由支持不同后端的多线程SQL服务器，几个不同的客户端程序和库，管理工具以及各种应用程序编程接口（API）组成。<br>MySQL Server作为嵌入式多线程库，可以将其链接到应用程序，以获得更小，更快，更易于管理的独立产品。</p>
<h3 id="MySQL特点"><a href="#MySQL特点" class="headerlink" title="MySQL特点"></a>MySQL特点</h3><ul>
<li>内部和可移植性</li>
<li>用C和C ++编写。</li>
<li>经过多种不同编译器的测试。</li>
<li>适用于许多不同的平台。</li>
<li>为了便于携带，在MySQL 5.5及更高版本中使用CMake。以前的系列使用GNU Automake，Autoconf和Libtool。</li>
<li>使用Purify（商业内存泄漏检测器）以及GPL工具Valgrind（<a href="http://developer.kde.org/~sewardj/）进行测试。" target="_blank" rel="noopener">http://developer.kde.org/~sewardj/）进行测试。</a></li>
<li>使用具有独立模块的多层服务器设计。</li>
<li>设计为使用内核线程完全多线程，以便在可用时轻松使用多个CPU。</li>
<li>提供事务性和非事务性存储引擎。</li>
<li>使用非常快的 B-tree 磁盘表 (MyISAM）实现索引压缩。</li>
<li>旨在使添加其他存储引擎相对容易。如果要为内部数据库提供SQL接口，这非常有用。</li>
<li>使用非常快速的基于线程的内存分配系统。</li>
<li>使用优化的嵌套循环连接执行速度非常快。</li>
<li>实现内存中的哈希表用作临时表。</li>
<li>使用应尽可能快的高度优化的类库实现SQL函数。通常在查询初始化之后根本没有内存分配。</li>
<li>将服务器作为单独的程序提供，用于客户端/服务器网络环境，以及作为可嵌入（链接）到独立应用程序的库。此类应用程序可以单独使用，也可以在没有网络的环境中使用。</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ul>
<li>许多数据类型：有符号/无符号整数，8个字节长的数据，float(浮点型)， double(双精度型)， char(字符)， varchar(变长字符串)， binary(二进制)，varbinary(可变二进制)， text(文本)， blob， date， time， datetime， timestamp， year， set， enum，和开放GIS空间类型。</li>
<li>固定长度和可变长度的字符串类型。</li>
</ul>
<h3 id="函数和语句"><a href="#函数和语句" class="headerlink" title="函数和语句"></a>函数和语句</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;SELECT列表和 WHERE子句查询中的 完整运算符和函数支持 。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT CONCAT(first_name, &apos; &apos;, last_name)</span><br><span class="line">    -&gt; FROM citizen</span><br><span class="line">    -&gt; WHERE income/dependents &gt; 10000 AND age &gt; 30;</span><br></pre></td></tr></table></figure>
<ul>
<li>完全支持SQL GROUP BY和 ORDER BY子句。支持基函数（COUNT()， AVG()， STD()， SUM()， MAX()， MIN()，和GROUP_CONCAT()）。</li>
<li>支持LEFT OUTER JOIN和 RIGHT OUTER JOIN使用标准SQL和ODBC语法。</li>
<li>根据标准SQL的要求支持表和列上的别名。</li>
<li>支持DELETE， INSERT， REPLACE，和 UPDATE以返回更改（受影响）的行数，或返回通过连接到服务器时设置标志，而不是匹配的行的数量。</li>
<li>支持特定于MySQL的SHOW语句，用于检索有关数据库，存储引擎，表和索引的信息。支持 INFORMATION_SCHEMA数据库，根据标准SQL实现。</li>
<li>一个EXPLAIN语句来显示优化器如何解决一个查询。</li>
<li>表名或列名中函数名的独立性。例如，ABS是一个有效的列名。唯一的限制是，对于函数调用，函数名和它后面的“ (”之间不允许有空格 。</li>
<li>可以在同一语句中引用来自不同数据库的表。</li>
</ul>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><ul>
<li>特权和密码系统，非常灵活和安全，可以进行基于主机的验证。</li>
<li>连接到服务器时加密所有密码流量的密码安全性。</li>
</ul>
<h3 id="可扩展性和限制"><a href="#可扩展性和限制" class="headerlink" title="可扩展性和限制"></a>可扩展性和限制</h3><ul>
<li>支持大型数据库。我们将MySQL Server与包含5000万条记录的数据库结合使用。</li>
<li>每个表最多支持64个索引。每个索引可以包含1到16列或部分列。InnoDB表的最大索引宽度为767字节或3072字节。MyISAM表的最大索引宽度为1000个字节。索引可使用的柱的前缀CHAR， VARCHAR， BLOB，或 TEXT列类型。</li>
</ul>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><ul>
<li>客户端可以使用多种协议连接到MySQL Server:<br>  i. 客户端可以在任何平台上使用TCP / IP套接字进行连接。<br>  ii. 在Windows系统上，如果使用该–enable-named-pipe选项启动服务器，则客户端可以使用命名管道进行连接。如果使用该–shared-memory选项启动，Windows服务器也支持共享内存连接。客户端可以使用该–protocol=memory选项通过共享内存进行连接。<br>  iii. 在Unix系统上，客户端可以使用Unix域套接字文件进行连接。</li>
</ul>
<ul>
<li>MySQL客户端程序可以用多种语言编写。用C编写的客户端库可用于用C或C ++编写的客户端，或者用于提供C绑定的任何语言。</li>
<li>提供C，C ++，Eiffel，Java，Perl，PHP，Python，Ruby和Tcl的API，使MySQL客户端能够以多种语言编写。</li>
</ul>
<h3 id="客户端和工具"><a href="#客户端和工具" class="headerlink" title="客户端和工具"></a>客户端和工具</h3><ul>
<li>MySQL包括几个客户端和实用程序。这些包括命令行程序，如 mysqldump和 mysqladmin，以及图形程序，如 MySQL Workbench。</li>
<li>MySQL Server内置支持SQL语句来检查，优化和修复表。这些语句可以从命令行通过 mysqlcheck客户端获得。MySQL还包括myisamchk，这是一个非常快速的命令行实用程序，用于在MyISAM 表上执行这些操作。</li>
<li>可以使用–help 或-?选项调用MySQL程序以获取在线帮助。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/19/Cisco-UCS-B200-M2安装操作系统/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/" itemprop="url">Cisco UCS B200 M2安装操作系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-19T20:18:53+08:00">
                2019-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  304
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/1.png">
<p>由于项目需要，要求把上图系统更换为 CentOS7. 踩了不少坑，折腾一天。<br> 服务器的型号为UCS B200 M2 ,需要在网页登录他的管理器，本地的java环境为jdk-6u10。6版本的每一个我都试了，只有这个可以。<br>在kvm manager的页面可以下载kvm console 的java程序，在本地运行就可以了  </p>
<p>该刀片服务器重装\安装系统需要从本地映射镜像到服务器，也是在网上看的服务器配置指导才知道，我还想着拿个显示屏怼上呢。映射步骤如下：</p>
<p>1.点击virtual Medis （如果报错虚拟磁盘本地库无法加载，那就是java版本的问题了）</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/2.png">
<p>2.左侧有”Add Images”，选中需要安装的系统就可以了</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/3.png">
<p>3.勾选上第一列的Mapped ，即将本地镜像文件映射到 “Virtual CD/DVD”</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/4.png">
<p>4.重启</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/5.png">
<p>5.在该界面进入boot menu ，更改启动顺序</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/6.png">
<p>6.选择”Cisco Virtual CD/DVD  1.22”，不要选择EFI那一项</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/7.png">
<p>之后就是安装CentOS的步骤了，除了在分盘的时候把之前的分区先删除干净之外，其他步骤都相同了</p>
<img src="/2019/01/19/Cisco-UCS-B200-M2安装操作系统/8.png">
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/16/编译安装mysql-server5-6-32/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/16/编译安装mysql-server5-6-32/" itemprop="url">编译安装mysql-server5.6.32</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-16T16:51:54+08:00">
                2019-01-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  440
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>摘自：<a href="http://www.cnblogs.com/yaohan/p/6288620.html" target="_blank" rel="noopener">http://www.cnblogs.com/yaohan/p/6288620.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://downloads.mysql.com/archives/get/file/mysql-5.6.32.tar.gz  </span><br><span class="line">tar -zxvf mysql-5.6.32.tar.gz</span><br></pre></td></tr></table></figure>
<p>安装编译环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++</span><br><span class="line">yum install -y ncurses-devel</span><br><span class="line">yum install -y cmake</span><br><span class="line">yum install -y libaio</span><br><span class="line">yum install -y bison</span><br><span class="line">yum install -y perl-Module-Install.noarch</span><br></pre></td></tr></table></figure>
<p>编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql  </span><br><span class="line">-DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock  </span><br><span class="line">-DDEFAULT_CHARSET=utf8</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1</span><br><span class="line">-DWITH_ARCHIVE_STORAGE_ENGINE=1</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1</span><br><span class="line">-DMYSQL_DATADIR=/home/mysqldata</span><br><span class="line">-DMYSQL_TCP_PORT=3306</span><br><span class="line">-DENABLE_DOWNLOADS=1</span><br></pre></td></tr></table></figure>
<p><strong>若要重新运行配置，需要删除目录内CMakeCache.txt文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm CMakeCache.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>使用下面的命令查看是否有mysql用户及用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd   #查看用户列表</span><br><span class="line">cat /etc/group    #查看用户组列表</span><br><span class="line"></span><br><span class="line">如果没有就创建</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line">修改/usr/local/mysql权限</span><br><span class="line">chown -R mysql:mysql /usr/local/mysql</span><br></pre></td></tr></table></figure>
<p>修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/my-default.cnf /etc/my.cnf</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----my.cnf begin------</span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket = /usr/local/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"># Remove leading # and set to the amount of RAM for the most important data</span><br><span class="line"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span><br><span class="line"># innodb_buffer_pool_size = 128M</span><br><span class="line"></span><br><span class="line"># Remove leading # to turn on a very important data integrity option: logging</span><br><span class="line"># changes to the binary log between backups.</span><br><span class="line"># log_bin</span><br><span class="line"></span><br><span class="line"># These are commonly set, remove the # and set as required.</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /home/mysqldata/</span><br><span class="line">port = 3306</span><br><span class="line"># server_id = .....</span><br><span class="line">socket = /usr/local/mysql/mysql.sock</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># Remove leading # to set options mainly useful for reporting servers.</span><br><span class="line"># The server defaults are faster for transactions and fast SELECTs.</span><br><span class="line"># Adjust sizes as needed, experiment to find the optimal values.</span><br><span class="line"># join_buffer_size = 128M</span><br><span class="line"># sort_buffer_size = 2M</span><br><span class="line"># read_rnd_buffer_size = 2M</span><br><span class="line"></span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">-----my.cnf end------</span><br></pre></td></tr></table></figure>
<p>初始化数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/</span><br><span class="line">./scripts/mysql_install_db --user=mysql --datadir=/home/mysqldata</span><br></pre></td></tr></table></figure>
<p>修改文件和目录权限，否则开启服务会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:root /usr/local/mysql/mysql.sock</span><br><span class="line">chown -R mysql:root /usr/local/mysql</span><br></pre></td></tr></table></figure>
<p>测试开启编译安装的Mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqld_safe</span><br></pre></td></tr></table></figure>
<p>运行正常则添加启动脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">chkconfig mysql on</span><br><span class="line">service mysql start  --启动MySQL</span><br><span class="line">ln -s /usr/local/mysql/bin/mysql /usr/bin</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/15/harbor配置文件介绍/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/15/harbor配置文件介绍/" itemprop="url">harbor配置文件介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-15T13:01:34+08:00">
                2019-01-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There are two categories of parameters in harbor.cfg, required parameters and optional parameters.<br>在harbor.cfg中有两类参数，必需参数和可选参数。</p>
<p>required parameters: These parameters are required to be set in the configuration file. They will take effect if a user updates them in  harbor.cfg  and run the   install.sh   script to reinstall Harbor.<br>required参数：需要在配置文件中设置这些参数。如果用户更新它们harbor.cfg 并运行 install.sh 脚本以重新安装Harbor，它们将生效。</p>
<p>optional parameters: These parameters are optional for updating, i.e. user can leave them as default and update them on Web Portal after Harbor is started. If they are set in harbor.cfg, they only take effect in the first launch of Harbor. Subsequent update to these parameters in harbor.cfg will be ignored.<br>可选参数：这些参数对于更新是可选的，即用户可以将它们保留为默认值，并在启动Harbour后在Web Portal(门户网站)上更新它们。如果它们已经启用harbor.cfg，它们只会在首次启动Harbour时生效。harbor.cfg将忽略对这些参数的后续更新。</p>
<p>Note: If you choose to set these parameters via the Portal, be sure to do so right after Harbor is started. In particular, you must set the desired auth_mode before registering or creating any new users in Harbor. When there are users in the system (besides the default admin user), auth_mode cannot be changed.<br>注意：如果你选择通过Portal设置这些参数，请务必在Harbour启动后立即执行此操作。特别是，你必须在Harbour中注册或创建任何新用户之前设置auth_mode。当系统中有用户时（除默认管理员用户外）， 无法更改auth_mode。</p>
<h3 id="Required-parameters-必须参数"><a href="#Required-parameters-必须参数" class="headerlink" title="Required parameters:  必须参数"></a>Required parameters:  必须参数</h3><p>hostname: The target host’s hostname, which is used to access the Portal and the registry service. It should be the IP address or the fully qualified domain name (FQDN) of your target machine, e.g., 192.168.1.10 or reg.yourdomain.com. Do NOT use localhost or 127.0.0.1 for the hostname - the registry service needs to be accessible by external clients!<br><strong>hostname</strong>：目标主机的主机名，用于访问Portal和registry服务。它应该是目标计算机的IP地址或完全限定的域名（FQDN），例如，192.168.1.10或reg.yourdomain.com。不要使用localhost或127.0.0.1作为主机名 - 外部客户端需要访问registry服务！</p>
<p>ui_url_protocol: (http or https. Default is http) The protocol used to access the Portal and the token/notification service. If Notary is enabled, this parameter has to be https. By default, this is http.<br><strong>ui_url_protocol</strong> :( http或https。默认为http）用于访问Portal和令牌/通知服务的协议。如果启用了公证，则此参数必须为https。默认情况下是http。</p>
<p>db_password: The root password for the PostgreSQL database used for db_auth. Change this password for any production use!<br><strong>db_password</strong>：用于db_auth的PostgreSQL数据库的root密码。生产环境中要修改密码！</p>
<p>max_job_workers: (default value is 10) The maximum number of replication workers in job service. For each image replication job, a worker synchronizes all tags of a repository to the remote destination. Increasing this number allows more concurrent replication jobs in the system. However, since each worker consumes a certain amount of network/CPU/IO resources, please carefully pick the value of this attribute based on the hardware resource of the host.<br><strong>max_job_workers</strong> :(默认值为10）作业服务中的最大复制工作数。对于每个镜像复制作业，工作程序将存储库的所有标记同步到远程目标。增加此数量可以在系统中实现更多并发复制作业。但是，由于每个工作者都消耗一定量的网络/ CPU / IO资源，请根据主机的硬件资源仔细选择该属性的值。</p>
<p>customize_crt: (on or off. Default is on) When this attribute is on, the prepare script creates private key and root certificate for the generation/verification of the registry’s token. Set this attribute to off when the key and root certificate are supplied by external sources.<br><strong>customize_crt</strong>：（开启或关闭，默认为开启），如果此属性开启，在准备脚本创建registry的令牌生成/验证私钥和根证书。当外部源提供密钥和根证书时，将此属性设置为off。</p>
<p>ssl_cert: The path of SSL certificate, it’s applied only when the protocol is set to https.<br><strong>ssl_cert</strong>：SSL证书的路径，仅在协议设置为https时应用。  </p>
<p>ssl_cert_key: The path of SSL key, it’s applied only when the protocol is set to https.<br><strong>ssl_cert_key</strong>：SSL密钥的路径，仅在协议设置为https时应用。  </p>
<p>secretkey_path: The path of key for encrypt or decrypt the password of a remote registry in a replication policy.<br><strong>secretkey_path</strong>：用于加密或解密复制策略中远程registry密码的密钥路径。  </p>
<p>log_rotate_count: Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.<br><strong>log_rotate_count</strong>：日志文件在被删除之前会被轮换log_rotate_count次。如果count为0，则删除旧版本而不会轮转。</p>
<p>log_rotate_size: Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes. If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G are all valid.<br><strong>log_rotate_size</strong>：仅当日志文件大于log_rotate_size字节时才会轮换日志文件。如果大小后跟k，则假定大小以千字节为单位。如果使用M，则大小以兆字节为单位，如果使用G，则大小为千兆字节。尺寸100，尺寸100k，尺寸100M和尺寸100G都是有效的。 </p>
<p>http_proxy: Config http proxy for Clair, e.g. <a href="http://my.proxy.com:3128" target="_blank" rel="noopener">http://my.proxy.com:3128</a>.<br><strong>http_proxy</strong>：为Clair配置http代理，例如<a href="http://my.proxy.com:3128。" target="_blank" rel="noopener">http://my.proxy.com:3128。</a></p>
<p>https_proxy: Config https proxy for Clair, e.g. <a href="http://my.proxy.com:3128" target="_blank" rel="noopener">http://my.proxy.com:3128</a>.<br><strong>https_proxy</strong>：为Clair配置https代理，例如<a href="http://my.proxy.com:3128。" target="_blank" rel="noopener">http://my.proxy.com:3128。</a></p>
<p>no_proxy: Config no proxy for Clair, e.g. 127.0.0.1,localhost,core,registry.<br><strong>no_proxy</strong>：为Clair配置无代理，例如127.0.0.1,localhost,core,registry。</p>
<h3 id="Optional-parameters-可选参数"><a href="#Optional-parameters-可选参数" class="headerlink" title="Optional parameters 可选参数"></a>Optional parameters 可选参数</h3><p>Email settings: These parameters are needed for Harbor to be able to send a user a “password reset” email, and are only necessary if that functionality is needed. Also, do note that by default SSL connectivity is not enabled - if your SMTP server requires SSL, but does not support STARTTLS, then you should enable SSL by setting email_ssl = true. Setting email_insecure = true if the email server uses a self-signed or untrusted certificate.<br><strong>电子邮件设置</strong>：Harbor需要这些参数才能向用户发送“密码重置”电子邮件，并且仅在需要该功能时才需要。另外，请注意，在默认情况下SSL连接是禁用的，如果你的SMTP服务器需要SSL，但不支持STARTTLS，那么你应该通过设置启用SSL email_ssl = TRUE。如果电子邮件服务器使用自签名证书或不受信任证书，则设置email_insecure = true。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">email_server = smtp.mydomain.com</span><br><span class="line">email_server_port = 25</span><br><span class="line">email_identity =</span><br><span class="line">email_username = sample_admin@mydomain.com</span><br><span class="line">email_password = abc</span><br><span class="line">email_from = admin sample_admin@mydomain.com</span><br><span class="line">email_ssl = false</span><br><span class="line">email_insecure = false</span><br></pre></td></tr></table></figure>
<p>harbor_admin_password: The administrator’s initial password. This password only takes effect for the first time Harbor launches. After that, this setting is ignored and the administrator’s password should be set in the Portal. Note that the default username/password are admin/Harbor12345 .<br><strong>harbor_admin_password</strong>：管理员的初始密码。此密码仅在Harbor首次启动时生效。之后，将忽略此设置，并且应在Portal中设置管理员密码。请注意，默认用户名/密码为admin / Harbor12345。</p>
<p>auth_mode: The type of authentication that is used. By default, it is db_auth, i.e. the credentials are stored in a database. For LDAP authentication, set this to ldap_auth.<br><strong>auth_mode</strong>：使用的身份验证类型。默认情况下，它是db_auth，即凭据存储在数据库中。对于LDAP身份验证，请将其设置为ldap_auth.<br>IMPORTANT: When upgrading from an existing Harbor instance, you must make sure auth_mode is the same in harbor.cfg before launching the new version of Harbor. Otherwise, users may not be able to log in after the upgrade.<br>重要信息：从现有Harbor实例升级时，必须确保在启动新版本的Harbor之前harbor.cfg中的auth_mode相同。否则，用户可能无法在升级后登录。</p>
<p>ldap_url: The LDAP endpoint URL (e.g. ldaps://ldap.mydomain.com). Only used when auth_mode is set to ldap_auth .<br><strong>ldap_url</strong>：LDAP端点URL（例如ldaps://ldap.mydomain.com）。 仅在auth_mode设置为ldap_auth时使用。  </p>
<p>ldap_searchdn: The DN of a user who has the permission to search an LDAP/AD server (e.g. uid=admin,ou=people,dc=mydomain,dc=com).<br><strong>ldap_searchdn</strong>：具有搜索LDAP/AD服务器权限的用户的DN（例如uid=admin,ou=people,dc=mydomain,dc=com）。  </p>
<p>ldap_search_pwd: The password of the user specified by ldap_searchdn.<br><strong>ldap_search_pwd</strong>：ldap_searchdn指定的用户密码。</p>
<p>ldap_basedn: The base DN to look up a user, e.g. ou=people,dc=mydomain,dc=com. Only used when auth_mode is set to ldap_auth .<br><strong>ldap_basedn</strong>：查找用户的基本DN，例如ou=people,dc=mydomain,dc=com。 仅在auth_mode设置为ldap_auth时使用。</p>
<p>ldap_filter: The search filter for looking up a user, e.g. (objectClass=person).<br><strong>ldap_filter</strong>：用于查找用户的搜索过滤器，例如(objectClass=person)</p>
<p>ldap_uid: The attribute used to match a user during a LDAP search, it could be uid, cn, email or other attributes.<br><strong>ldap_uid</strong>：用于在LDAP搜索期间匹配用户的属性，它可以是uid，cn，email或其他属性。</p>
<p>ldap_scope: The scope to search for a user, 0-LDAP_SCOPE_BASE, 1-LDAP_SCOPE_ONELEVEL, 2-LDAP_SCOPE_SUBTREE. Default is 2.<br><strong>ldap_scope</strong>：搜索用户的范围，0-LDAP_SCOPE_BASE，1-LDAP_SCOPE_ONELEVEL，2-LDAP_SCOPE_SUBTREE。默认值为2。</p>
<p>ldap_timeout: Timeout (in seconds) when connecting to an LDAP Server. Default is 5.<br><strong>ldap_timeout</strong>：连接LDAP服务器时超时（以秒为单位）。默认值为5。</p>
<p>ldap_verify_cert: Verify certificate from LDAP server. Default is true.<br><strong>ldap_verify_cert</strong>：验证来自LDAP服务器的证书。默认为true。</p>
<p>ldap_group_basedn: The base dn from which to lookup a group in LDAP/AD, e.g. ou=group,dc=mydomain,dc=com.<br><strong>ldap_group_basedn</strong>：在LDAP / AD中查找组的基本dn，例如ou=group,dc=mydomain,dc=com。</p>
<p>ldap_group_filter: The filter to search LDAP/AD group, e.g. objectclass=group.<br><strong>ldap_group_filter</strong>：搜索LDAP / AD组的过滤器，例如objectclass=group。</p>
<p>ldap_group_gid: The attribute used to name a LDAP/AD group, it could be cn, name.<br><strong>ldap_group_gid</strong>：用于命名LDAP / AD组的属性，它可以是cn，name。</p>
<p>ldap_group_scope: The scope to search for ldap groups. 0-LDAP_SCOPE_BASE, 1-LDAP_SCOPE_ONELEVEL, 2-LDAP_SCOPE_SUBTREE. Default is 2.<br><strong>ldap_group_scope</strong>：搜索ldap组的范围。0-LDAP_SCOPE_BASE，1-LDAP_SCOPE_ONELEVEL，2-LDAP_SCOPE_SUBTREE。默认值为2。</p>
<p>self_registration: (on or off. Default is on) Enable / Disable the ability for a user to register himself/herself. When disabled, new users can only be created by the Admin user, only an admin user can create new users in Harbor. NOTE: When auth_mode is set to ldap_auth, self-registration feature is always disabled, and this flag is ignored.<br><strong>self_registration</strong> :( 打开或关闭。默认打开）启用/禁用用户注册功能。禁用时，新用户只能由管理员用户创建，只有管理员用户可以在Harbor中创建新用户。注意：当auth_mode设置为ldap_auth时，始终禁用自注册功能，并忽略此标志。</p>
<p>token_expiration: The expiration time (in minutes) of a token created by token service, default is 30 minutes.<br><strong>token_expiration</strong>：令牌服务创建的令牌的到期时间（以分钟为单位），默认为30分钟。</p>
<p>project_creation_restriction: The flag to control what users have permission to create projects. By default everyone can create a project, set to “adminonly” such that only admin can create project.<br><strong>project_creation_restriction</strong>：用于控制用户有权创建项目的标志。默认情况下，每个人都可以创建一个项目；设置为“adminonly”，则只有管理员才能创建项目。</p>
<h3 id="Configuring-storage-backend-optional-配置存储后端（可选）"><a href="#Configuring-storage-backend-optional-配置存储后端（可选）" class="headerlink" title="Configuring storage backend (optional) 配置存储后端（可选）"></a>Configuring storage backend (optional) 配置存储后端（可选）</h3><p>By default, Harbor stores images on your local filesystem. In a production environment, you may consider using other storage backend instead of the local filesystem, like S3, OpenStack Swift, Ceph, etc. These parameters are configurations for registry.<br>默认情况下，Harbor将镜像存储在本地文件系统中。在生产环境中，您可以考虑使用其他存储后端而不是本地文件系统，如S3，OpenStack Swift，Ceph等。这些参数是registry的配置。</p>
<p>registry_storage_provider_name: Storage provider name of registry, it can be filesystem, s3, gcs, azure, etc. Default is filesystem.<br><strong>registry_storage_provider_name</strong>：存储仓库名称，可以是filesystem，s3，gcs，azure等。默认为filesystem。</p>
<p>registry_storage_provider_config: Comma separated “key: value” pairs for storage provider config, e.g. “key1: value, key2: value2”. Default is empty string.<br><strong>registry_storage_provider_config</strong>：配置分隔键值对，例如“key1：value，key2：value2”。默认为空字符串。</p>
<p>registry_custom_ca_bundle: The path to the custom root ca certificate, which will be injected into the truststore of registry’s and chart repository’s containers. This is usually needed when the user hosts a internal storage with self signed certificate.<br><strong>registry_custom_ca_bundle</strong>：当用户使用自签名证书托管内部存储时，通常需要自定义根ca证书的路径，它将注入到registry和image存储库容器的信任库中。<br>例如，如果使用Openstack Swift作为存储后端，则参数可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">registry_storage_provider_name = swift</span><br><span class="line">registry_storage_provider_config = “ username：admin，password：ADMIN_PASS，authurl：http：// kestone_addr：35357 / v3 / auth，tenant：admin，domain：default，region：regionOne，container：docker_images ”</span><br></pre></td></tr></table></figure>
<ul>
<li style="list-style: none"><input type="checkbox"> 对于LADP以及证书不理解，需要加入到后续的学习计划。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/12/harbor-企业级docker-registry/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="戴树谦">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile_photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="戴树谦的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/12/harbor-企业级docker-registry/" itemprop="url">harbor  企业级docker registry</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-12T15:55:45+08:00">
                2019-01-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  18
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="关于Harbor"><a href="#关于Harbor" class="headerlink" title="关于Harbor"></a>关于Harbor</h3><p>Harbor is an an open source trusted cloud native registry project that stores, signs, and scans content. Harbor extends the open source Docker Distribution by adding the functionalities usually required by users such as security, identity and management. Having a registry closer to the build and run environment can improve the image transfer efficiency. Harbor supports replication of images between registries, and also offers advanced security features such as user management, access control and activity auditing.<br>Harbor是一个开源的可信云本机registry项目，用于存储，签名和扫描内容。Harbor通过添加用户通常需要的功能（如安全性，身份和管理）来扩展开源Docker Distribution。使注册表更接近构建和运行环境可以提高图像传输效率。Harbor支持在注册表之间复制映像，还提供高级安全功能，如用户管理，访问控制和活动审计。</p>
<h4 id="Features-特性"><a href="#Features-特性" class="headerlink" title="Features  特性"></a>Features  特性</h4><h5 id="Cloud-native-registry-With-support-for-both-container-images-and-Helm-charts-Harbor-serves-as-registry-for-cloud-native-environments-like-container-runtimes-and-orchestration-platforms"><a href="#Cloud-native-registry-With-support-for-both-container-images-and-Helm-charts-Harbor-serves-as-registry-for-cloud-native-environments-like-container-runtimes-and-orchestration-platforms" class="headerlink" title="Cloud native registry: With support for both container images and Helm charts, Harbor serves as registry for cloud native environments like container runtimes and orchestration platforms."></a>Cloud native registry: With support for both container images and Helm charts, Harbor serves as registry for cloud native environments like container runtimes and orchestration platforms.</h5><p>云本机registry：Harbour支持容器镜像和Helm图表，可用作云本机环境（如容器运行时和业务流程平台）的registry。</p>
<h5 id="Role-based-access-control-Users-and-repositories-are-organized-via-‘projects’-and-a-user-can-have-different-permission-for-images-under-a-project"><a href="#Role-based-access-control-Users-and-repositories-are-organized-via-‘projects’-and-a-user-can-have-different-permission-for-images-under-a-project" class="headerlink" title="Role based access control: Users and repositories are organized via ‘projects’ and a user can have different permission for images under a project."></a>Role based access control: Users and repositories are organized via ‘projects’ and a user can have different permission for images under a project.</h5><p>基于角色的访问控制：用户和存储库通过“项目”进行组织，用户可以对项目下的镜像拥有不同的权限。</p>
<h5 id="Policy-based-image-replication-Images-can-be-replicated-synchronized-between-multiple-registry-instances-based-on-policies-with-multiple-filters-repository-tag-and-label-Harbor-will-auto-retry-to-replicate-if-it-encounters-any-errors-Great-for-load-balancing-high-availability-multi-datacenter-hybrid-and-multi-cloud-scenarios"><a href="#Policy-based-image-replication-Images-can-be-replicated-synchronized-between-multiple-registry-instances-based-on-policies-with-multiple-filters-repository-tag-and-label-Harbor-will-auto-retry-to-replicate-if-it-encounters-any-errors-Great-for-load-balancing-high-availability-multi-datacenter-hybrid-and-multi-cloud-scenarios" class="headerlink" title="Policy based image replication: Images can be replicated (synchronized) between multiple registry instances based on policies with multiple filters (repository, tag and label). Harbor will auto-retry to replicate if it encounters any errors. Great for load balancing, high availability, multi-datacenter, hybrid and multi-cloud scenarios."></a>Policy based image replication: Images can be replicated (synchronized) between multiple registry instances based on policies with multiple filters (repository, tag and label). Harbor will auto-retry to replicate if it encounters any errors. Great for load balancing, high availability, multi-datacenter, hybrid and multi-cloud scenarios.</h5><p>基于策略的镜像复制：可以基于具有多个过滤器（存储库，标记和标签）的策略在多个registry实例之间复制（同步）镜像。如果遇到任何错误，Harbor将自动重试进行复制。非常适合负载平衡，高可用性，多数据中心，混合和多云场景。</p>
<h5 id="Vulnerability-Scanning-Harbor-scans-images-regularly-and-warns-users-of-vulnerabilities"><a href="#Vulnerability-Scanning-Harbor-scans-images-regularly-and-warns-users-of-vulnerabilities" class="headerlink" title="Vulnerability Scanning: Harbor scans images regularly and warns users of vulnerabilities."></a>Vulnerability Scanning: Harbor scans images regularly and warns users of vulnerabilities.</h5><p>漏洞扫描：Harbor定期扫描镜像并警告用户漏洞。</p>
<h5 id="LDAP-AD-support-Harbor-integrates-with-existing-enterprise-LDAP-AD-for-user-authentication-and-management-and-supports-importing-LDAP-groups-into-Harbor-and-assigning-proper-project-roles-to-them"><a href="#LDAP-AD-support-Harbor-integrates-with-existing-enterprise-LDAP-AD-for-user-authentication-and-management-and-supports-importing-LDAP-groups-into-Harbor-and-assigning-proper-project-roles-to-them" class="headerlink" title="LDAP/AD support: Harbor integrates with existing enterprise LDAP/AD for user authentication and management, and supports importing LDAP groups into Harbor and assigning proper project roles to them."></a>LDAP/AD support: Harbor integrates with existing enterprise LDAP/AD for user authentication and management, and supports importing LDAP groups into Harbor and assigning proper project roles to them.</h5><p>LDAP / AD支持：Harbor与现有企业LDAP / AD集成以进行用户身份验证和管理，并支持将LDAP组导入Harbor并为其分配适当的项目角色。</p>
<h5 id="Image-deletion-amp-garbage-collection-Images-can-be-deleted-and-their-space-can-be-recycled"><a href="#Image-deletion-amp-garbage-collection-Images-can-be-deleted-and-their-space-can-be-recycled" class="headerlink" title="Image deletion &amp; garbage collection: Images can be deleted and their space can be recycled."></a>Image deletion &amp; garbage collection: Images can be deleted and their space can be recycled.</h5><p>图像删除和垃圾收集：可以删除镜像，并可以回收它们的空间。</p>
<h5 id="Notary-Image-authenticity-can-be-ensured"><a href="#Notary-Image-authenticity-can-be-ensured" class="headerlink" title="Notary: Image authenticity can be ensured."></a>Notary: Image authenticity can be ensured.</h5><p>公证：可以确保镜像的真实性。</p>
<h5 id="Graphical-user-portal-User-can-easily-browse-search-repositories-and-manage-projects"><a href="#Graphical-user-portal-User-can-easily-browse-search-repositories-and-manage-projects" class="headerlink" title="Graphical user portal: User can easily browse, search repositories and manage projects."></a>Graphical user portal: User can easily browse, search repositories and manage projects.</h5><p>用户图形界面：用户可以轻松浏览，搜索存储库和管理项目。</p>
<h5 id="Auditing-All-the-operations-to-the-repositories-are-tracked"><a href="#Auditing-All-the-operations-to-the-repositories-are-tracked" class="headerlink" title="Auditing: All the operations to the repositories are tracked."></a>Auditing: All the operations to the repositories are tracked.</h5><p>审计：跟踪存储库的所有操作。</p>
<h5 id="RESTful-API-RESTful-APIs-for-most-administrative-operations-easy-to-integrate-with-external-systems"><a href="#RESTful-API-RESTful-APIs-for-most-administrative-operations-easy-to-integrate-with-external-systems" class="headerlink" title="RESTful API: RESTful APIs for most administrative operations, easy to integrate with external systems."></a>RESTful API: RESTful APIs for most administrative operations, easy to integrate with external systems.</h5><p>RESTful API：适用于大多数管理操作的RESTful API，易于与外部系统集成。</p>
<h5 id="Easy-deployment-Provide-both-an-online-and-offline-installer"><a href="#Easy-deployment-Provide-both-an-online-and-offline-installer" class="headerlink" title="Easy deployment: Provide both an online and offline installer."></a>Easy deployment: Provide both an online and offline installer.</h5><p>易于部署：提供在线和离线安装程序。</p>
<p>企业级Registry项目Harbor是由Vmware公司开发的开源项目，其的目标是帮助用户迅速搭建一个企业级的Docker registry 服务。它以Docker公司开源的registry 为基础，提供了管理UI, 基于角色的访问控制(Role Based Access Control)，AD/LDAP集成、以及审计日志(Audit logging) 等企业用户需求的功能，同时还原生支持中文。  </p>
<p>Harbor的每个组件都是以Docker 容器的形式构建的，因此很自然地，我们使用Docker Compose来对它进行部署。在源代码中(<a href="https://github.com/vmware/harbor)" target="_blank" rel="noopener">https://github.com/vmware/harbor)</a>, 用于部署Harbor的Docker Compose 模板位于 /Deployer/docker-compose.yml. 打开这个模板文件，会发现Harbor由5个容器组成：</p>
<ul>
<li>proxy: 由Nginx 服务器构成的反向代理。</li>
<li>registry:由Docker官方的开源registry 镜像构成的容器实例。 </li>
<li>ui: 即架构中的core services, 构成此容器的代码是Harbor项目的主体。</li>
<li>mysql: 由官方MySql镜像构成的数据库容器。</li>
<li>log: 运行着rsyslogd的容器，通过log-driver的形式收集其他容器的日志。  </li>
</ul>
<p>这几个容器通过Docker link的形式连接在一起，这样，在容器之间可以通过容器名字互相访问。对终端用户而言，只需要暴露proxy （即Nginx）的服务端口。（摘自 <a href="http://dockone.io/article/1179）" target="_blank" rel="noopener">http://dockone.io/article/1179）</a></p>
<h3 id="安装及配置"><a href="#安装及配置" class="headerlink" title="安装及配置"></a>安装及配置</h3><p>(参考 <a href="https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md" target="_blank" rel="noopener">https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md</a>   </p>
<img src="/2019/01/12/harbor-企业级docker-registry/1.png">  
<img src="/2019/01/12/harbor-企业级docker-registry/2.png">  
<img src="/2019/01/12/harbor-企业级docker-registry/3.png"> 
<p>下载harbor软件包：<a href="https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.1.tgz" target="_blank" rel="noopener">https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.1.tgz</a><br>harbor软件包较大，建议科学上网</p>
<p>解压后如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 harbor]# ls</span><br><span class="line">common                          docker-compose.clair.yml   docker-compose.yml  harbor.v1.7.1.tar.gz  LICENSE              prepare</span><br><span class="line">docker-compose.chartmuseum.yml  docker-compose.notary.yml  harbor.cfg          install.sh            open_source_license</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 ~]# yum info docker-compose</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.neusoft.edu.cn</span><br><span class="line"> * epel: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * extras: mirrors.nwsuaf.edu.cn</span><br><span class="line"> * updates: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line">已安装的软件包</span><br><span class="line">名称    ：docker-compose</span><br><span class="line">架构    ：noarch</span><br><span class="line">版本    ：1.18.0</span><br><span class="line">发布    ：2.el7</span><br><span class="line">大小    ：1.1 M</span><br><span class="line">源    ：installed</span><br><span class="line">来自源：epel</span><br><span class="line">简介    ： Multi-container orchestration for Docker</span><br><span class="line">网址    ：https://github.com/docker/compose</span><br><span class="line">协议    ： ASL 2.0</span><br><span class="line">描述    ： Compose is a tool for defining and running multi-container Docker</span><br><span class="line">         : applications. With Compose, you use a Compose file to configure your</span><br><span class="line">         : application&apos;s services. Then, using a single command, you create and</span><br><span class="line">         : start all the services from your configuration.</span><br><span class="line">         : </span><br><span class="line">         : Compose is great for development, testing, and staging environments,</span><br><span class="line">         : as well as CI workflows.</span><br><span class="line">         : </span><br><span class="line">         : Using Compose is basically a three-step process.</span><br><span class="line">         : </span><br><span class="line">         : 1. Define your app&apos;s environment with a Dockerfile so it can be</span><br><span class="line">         :    reproduced anywhere.</span><br><span class="line">         : 2. Define the services that make up your app in docker-compose.yml so</span><br><span class="line">         :    they can be run together in an isolated environment:</span><br><span class="line">         : 3. Lastly, run docker-compose up and Compose will start and run your</span><br><span class="line">         :    entire app.</span><br></pre></td></tr></table></figure>
<p>还需要docker-compose 编排工具，该工具在epel源中提供，所以需要先配置epel源；然后再安装即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum repolist</span><br><span class="line">yum install docker-compose</span><br></pre></td></tr></table></figure>
<p>python和openssl </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 ~]# openssl</span><br><span class="line">OpenSSL&gt; version</span><br><span class="line">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line">OpenSSL&gt; exit</span><br><span class="line">[root@Web2 ~]# python --version</span><br><span class="line">Python 2.7.5</span><br><span class="line">[root@Web2 ~]#</span><br></pre></td></tr></table></figure>
<p>修改harbor配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 ~]# vim /usr/local/harbor/harbor.cfg </span><br><span class="line">hostname = 172.18.74.101   //IP地址或域名</span><br><span class="line">max_job_workers = 3   //CPU数减一</span><br></pre></td></tr></table></figure>
<p>Harbor has integrated with Notary and Clair (for vulnerability scanning). However, the default installation does not include Notary or Clair service.<br>Harbor已与Notary和Clair集成（用于漏洞扫描）。但是，默认安装不包括Notary或Clair服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">执行脚本安装harbor</span><br><span class="line">[root@Web2 harbor]# ./install.sh </span><br><span class="line"></span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 18.09.0</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.18.0</span><br><span class="line"></span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">ae18db924eef: Loading layer [==================================================&gt;]  32.92MB/32.92MB</span><br><span class="line">1c06074dba9c: Loading layer [==================================================&gt;]  8.955MB/8.955MB</span><br><span class="line">7a719a639e34: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">49f7bca05da9: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">e86d69bef97e: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">81e122d773f5: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">5fe5adb8cf31: Loading layer [==================================================&gt;]   22.8MB/22.8MB</span><br><span class="line">d760045419e4: Loading layer [==================================================&gt;]   22.8MB/22.8MB</span><br><span class="line">Loaded image: goharbor/registry-photon:v2.6.2-v1.7.1</span><br><span class="line">c0f668a21621: Loading layer [==================================================&gt;]  133.2MB/133.2MB</span><br><span class="line">f8cb0bf39ff2: Loading layer [==================================================&gt;]    684MB/684MB</span><br><span class="line">444ac38a117b: Loading layer [==================================================&gt;]   7.68kB/7.68kB</span><br><span class="line">2e16f24ac8bc: Loading layer [==================================================&gt;]    212kB/212kB</span><br><span class="line">Loaded image: goharbor/harbor-migrator:v1.7.1</span><br><span class="line">fa2dcaba747a: Loading layer [==================================================&gt;]  8.955MB/8.955MB</span><br><span class="line">eeaaf4c760eb: Loading layer [==================================================&gt;]   15.6MB/15.6MB</span><br><span class="line">98ffd6175b61: Loading layer [==================================================&gt;]  18.94kB/18.94kB</span><br><span class="line">fc1db6c4f652: Loading layer [==================================================&gt;]   15.6MB/15.6MB</span><br><span class="line">Loaded image: goharbor/harbor-adminserver:v1.7.1</span><br><span class="line">8d55a6a034d6: Loading layer [==================================================&gt;]  8.955MB/8.955MB</span><br><span class="line">01ef68a17913: Loading layer [==================================================&gt;]  27.24MB/27.24MB</span><br><span class="line">f9258cfa4b48: Loading layer [==================================================&gt;]  5.632kB/5.632kB</span><br><span class="line">dcf5c61ede76: Loading layer [==================================================&gt;]  27.24MB/27.24MB</span><br><span class="line">Loaded image: goharbor/harbor-core:v1.7.1</span><br><span class="line">1f65d10893c9: Loading layer [==================================================&gt;]  50.39MB/50.39MB</span><br><span class="line">358f40be2091: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">c7f3ef058d0b: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">154caf7c7173: Loading layer [==================================================&gt;]  4.096kB/4.096kB</span><br><span class="line">42c7764aa777: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">023f3a96f324: Loading layer [==================================================&gt;]  10.24kB/10.24kB</span><br><span class="line">Loaded image: goharbor/harbor-log:v1.7.1</span><br><span class="line">a1b528067504: Loading layer [==================================================&gt;]  8.955MB/8.955MB</span><br><span class="line">2d3d34f3ba5b: Loading layer [==================================================&gt;]  21.51MB/21.51MB</span><br><span class="line">a5da70777097: Loading layer [==================================================&gt;]  21.51MB/21.51MB</span><br><span class="line">Loaded image: goharbor/harbor-jobservice:v1.7.1</span><br><span class="line">ab31dfc84e9d: Loading layer [==================================================&gt;]  8.954MB/8.954MB</span><br><span class="line">b130423af762: Loading layer [==================================================&gt;]  13.43MB/13.43MB</span><br><span class="line">357c059d0598: Loading layer [==================================================&gt;]   17.3MB/17.3MB</span><br><span class="line">fabc6edfac55: Loading layer [==================================================&gt;]  11.26kB/11.26kB</span><br><span class="line">cfaa3b5d445a: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">12c73a4b2c7a: Loading layer [==================================================&gt;]  30.72MB/30.72MB</span><br><span class="line">Loaded image: goharbor/notary-server-photon:v0.6.1-v1.7.1</span><br><span class="line">50a6467bd619: Loading layer [==================================================&gt;]    113MB/113MB</span><br><span class="line">6ae61fc91943: Loading layer [==================================================&gt;]  11.46MB/11.46MB</span><br><span class="line">5c840c272f78: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">077d16ebcba8: Loading layer [==================================================&gt;]  48.13kB/48.13kB</span><br><span class="line">b822f5ff7858: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">4548140152fd: Loading layer [==================================================&gt;]  11.51MB/11.51MB</span><br><span class="line">Loaded image: goharbor/clair-photon:v2.0.7-v1.7.1</span><br><span class="line">232024be30e3: Loading layer [==================================================&gt;]   3.39MB/3.39MB</span><br><span class="line">a73624ae3fad: Loading layer [==================================================&gt;]  4.721MB/4.721MB</span><br><span class="line">96b8c5c532c3: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: goharbor/harbor-portal:v1.7.1</span><br><span class="line">e2fd12afe6e8: Loading layer [==================================================&gt;]  63.31MB/63.31MB</span><br><span class="line">e973513bcb58: Loading layer [==================================================&gt;]  40.74MB/40.74MB</span><br><span class="line">4f45af643b2b: Loading layer [==================================================&gt;]  6.656kB/6.656kB</span><br><span class="line">54a84094f024: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">2d78cf8a687b: Loading layer [==================================================&gt;]   7.68kB/7.68kB</span><br><span class="line">e96067b83a72: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">38a7d304147f: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">a36c0cb6a35a: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">Loaded image: goharbor/harbor-db:v1.7.1</span><br><span class="line">b0c31ad64c85: Loading layer [==================================================&gt;]  65.01MB/65.01MB</span><br><span class="line">22fbab41769e: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">7f28bf5373b2: Loading layer [==================================================&gt;]   59.9kB/59.9kB</span><br><span class="line">abb9969cff2a: Loading layer [==================================================&gt;]  61.95kB/61.95kB</span><br><span class="line">Loaded image: goharbor/redis-photon:v1.7.1</span><br><span class="line">933cd9a15fc5: Loading layer [==================================================&gt;]   3.39MB/3.39MB</span><br><span class="line">Loaded image: goharbor/nginx-photon:v1.7.1</span><br><span class="line">6ee16a137af2: Loading layer [==================================================&gt;]  8.955MB/8.955MB</span><br><span class="line">954443cb7d20: Loading layer [==================================================&gt;]   22.8MB/22.8MB</span><br><span class="line">302a998137db: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">e342723aef9b: Loading layer [==================================================&gt;]  7.465MB/7.465MB</span><br><span class="line">4eeb61ed730b: Loading layer [==================================================&gt;]  30.26MB/30.26MB</span><br><span class="line">Loaded image: goharbor/harbor-registryctl:v1.7.1</span><br><span class="line">5b40d957fafd: Loading layer [==================================================&gt;]  12.11MB/12.11MB</span><br><span class="line">63489681dd6c: Loading layer [==================================================&gt;]   17.3MB/17.3MB</span><br><span class="line">696209dcd336: Loading layer [==================================================&gt;]  11.26kB/11.26kB</span><br><span class="line">8dc53997aa1f: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">cb6d560a9958: Loading layer [==================================================&gt;]  29.41MB/29.41MB</span><br><span class="line">Loaded image: goharbor/notary-signer-photon:v0.6.1-v1.7.1</span><br><span class="line">dc1e16790c89: Loading layer [==================================================&gt;]   8.96MB/8.96MB</span><br><span class="line">046c7e7a0100: Loading layer [==================================================&gt;]  35.08MB/35.08MB</span><br><span class="line">8c8428e3d6c6: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">ebb477ee35a2: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">19636f39e29d: Loading layer [==================================================&gt;]  35.08MB/35.08MB</span><br><span class="line">Loaded image: goharbor/chartmuseum-photon:v0.7.1-v1.7.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">Generated and saved secret to file: /data/secretkey</span><br><span class="line">Generated configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: ./common/config/adminserver/env</span><br><span class="line">Generated configuration file: ./common/config/core/env</span><br><span class="line">Generated configuration file: ./common/config/registry/config.yml</span><br><span class="line">Generated configuration file: ./common/config/db/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Generated configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">Generated configuration file: ./common/config/registryctl/env</span><br><span class="line">Generated configuration file: ./common/config/core/app.conf</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">The configuration files are ready, please use docker-compose to start the service.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 3]: checking existing instance of Harbor ...</span><br><span class="line">Creating registry ... done</span><br><span class="line">Creating harbor-core ... done</span><br><span class="line">[Step 4]: starting Harbor ...</span><br><span class="line">Creating harbor-portal ... done</span><br><span class="line">Creating nginx ... done</span><br><span class="line">Creating harbor-adminserver ... </span><br><span class="line">Creating harbor-db ... </span><br><span class="line">Creating redis ... </span><br><span class="line">Creating registry ... </span><br><span class="line">Creating registryctl ... </span><br><span class="line">Creating harbor-core ... </span><br><span class="line">Creating harbor-jobservice ... </span><br><span class="line">Creating harbor-portal ... </span><br><span class="line">Creating nginx ... </span><br><span class="line"></span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://172.18.74.101. </span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure>
<p>在安装 脚本执行过程过程中看到下拉了很多镜像，Harbor的每个组件都是以Docker 容器的形式构建的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 ~]# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">goharbor/chartmuseum-photon     v0.7.1-v1.7.1       f61c186d5b1b        6 days ago          111MB</span><br><span class="line">goharbor/harbor-migrator        v1.7.1              9ec6467899b6        6 days ago          799MB</span><br><span class="line">goharbor/redis-photon           v1.7.1              c7aa92fb1c26        6 days ago          96.3MB</span><br><span class="line">goharbor/clair-photon           v2.0.7-v1.7.1       832461eef7dd        6 days ago          165MB</span><br><span class="line">goharbor/notary-server-photon   v0.6.1-v1.7.1       382cd390eaff        6 days ago          102MB</span><br><span class="line">goharbor/notary-signer-photon   v0.6.1-v1.7.1       76486e1aa1a2        6 days ago          99.6MB</span><br><span class="line">goharbor/harbor-registryctl     v1.7.1              aefea98e6f92        6 days ago          101MB</span><br><span class="line">goharbor/registry-photon        v2.6.2-v1.7.1       13b348ffd0c9        6 days ago          86.4MB</span><br><span class="line">goharbor/nginx-photon           v1.7.1              9b9520572494        6 days ago          35.5MB</span><br><span class="line">goharbor/harbor-log             v1.7.1              0744800d7a4c        6 days ago          81MB</span><br><span class="line">goharbor/harbor-jobservice      v1.7.1              db96ce6ed531        6 days ago          83.8MB</span><br><span class="line">goharbor/harbor-core            v1.7.1              8f253c0f9d50        6 days ago          95.2MB</span><br><span class="line">goharbor/harbor-portal          v1.7.1              b50162ab177a        6 days ago          40.2MB</span><br><span class="line">goharbor/harbor-adminserver     v1.7.1              22d66cccedba        6 days ago          72MB</span><br><span class="line">goharbor/harbor-db              v1.7.1              c2a95254c0bf        6 days ago          133MB</span><br><span class="line">[root@Web2 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                    COMMAND                  CREATED              STATUS                        PORTS                                                              NAMES</span><br><span class="line">f007d1aae3fa        goharbor/nginx-photon:v1.7.1             &quot;nginx -g &apos;daemon of…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx</span><br><span class="line">bf48e808d152        goharbor/harbor-portal:v1.7.1            &quot;nginx -g &apos;daemon of…&quot;   About a minute ago   Up About a minute (healthy)   80/tcp                                                             harbor-portal</span><br><span class="line">0d78ea5ff51f        goharbor/harbor-jobservice:v1.7.1        &quot;/harbor/start.sh&quot;       About a minute ago   Up About a minute                                                                                harbor-jobservice</span><br><span class="line">c07ca8d7cf72        goharbor/harbor-core:v1.7.1              &quot;/harbor/start.sh&quot;       About a minute ago   Up About a minute (healthy)                                                                      harbor-core</span><br><span class="line">d6ce992225e9        goharbor/harbor-adminserver:v1.7.1       &quot;/harbor/start.sh&quot;       About a minute ago   Up About a minute (healthy)                                                                      harbor-adminserver</span><br><span class="line">86200773e6fc        goharbor/harbor-registryctl:v1.7.1       &quot;/harbor/start.sh&quot;       About a minute ago   Up About a minute (healthy)                                                                      registryctl</span><br><span class="line">a496f40a1d95        goharbor/harbor-db:v1.7.1                &quot;/entrypoint.sh post…&quot;   About a minute ago   Up About a minute (healthy)   5432/tcp                                                           harbor-db</span><br><span class="line">becbead56360        goharbor/redis-photon:v1.7.1             &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute             6379/tcp                                                           redis</span><br><span class="line">b66044203146        goharbor/registry-photon:v2.6.2-v1.7.1   &quot;/entrypoint.sh /etc…&quot;   About a minute ago   Up About a minute (healthy)   5000/tcp                                                           registry</span><br><span class="line">d6f266aa5a49        goharbor/harbor-log:v1.7.1               &quot;/bin/sh -c /usr/loc…&quot;   About a minute ago   Up About a minute (healthy)   127.0.0.1:1514-&gt;10514/tcp                                          harbor-log</span><br></pre></td></tr></table></figure>
<p>以admin/Harbor12345 默认登录名密码进行登录<br><img src="/2019/01/12/harbor-企业级docker-registry/4.png"><br><img src="/2019/01/12/harbor-企业级docker-registry/5.png"> </p>
<h3 id="将镜像推送至registry"><a href="#将镜像推送至registry" class="headerlink" title="将镜像推送至registry"></a>将镜像推送至registry</h3><p>Harbor的默认安装使用HTTP协议，需要将  –insecure-registry   参数添加进客户端的daemon.json 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu16:~# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line"> &quot;insecure-registries&quot;:[&quot;172.18.74.101&quot;]</span><br><span class="line">&#125;</span><br><span class="line">root@ubuntu16:~# systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>然后以admin身份登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu16:~# docker login 172.18.74.101</span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>
<p>对镜像进行打标 ，使用docker tag  命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu16:~# docker tag alpine 172.18.74.101/library/alpine:latest</span><br><span class="line">root@ubuntu16:~# docker image ls</span><br><span class="line">REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">alpine                         latest              196d12cf6ab1        4 months ago        4.41MB</span><br><span class="line">172.18.74.101/library/alpine   latest              196d12cf6ab1        4 months ago        4.41MB</span><br></pre></td></tr></table></figure>
<p>推送镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu16:~# docker push 172.18.74.101/library/alpine</span><br><span class="line">The push refers to a repository [172.18.74.101/library/alpine]</span><br><span class="line">df64d3292fd6: Pushed </span><br><span class="line">latest: digest: sha256:76ebd8b93b384fe8121d87be22c2089843f663fb342f1e6345a0a0bd6424c5c2 size: 528</span><br></pre></td></tr></table></figure>
<p>推送后在Harbor中即可看到alpine镜像<br><img src="/2019/01/12/harbor-企业级docker-registry/6.png"><br><img src="/2019/01/12/harbor-企业级docker-registry/7.png"> </p>
<h3 id="Harbor管理"><a href="#Harbor管理" class="headerlink" title="Harbor管理"></a>Harbor管理</h3><p>使用docker-compose命令可以用来管理Harbor，但是必须与docker-compose.yml在同一目录中运行，否则报错如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR: </span><br><span class="line">        Can&apos;t find a suitable configuration file in this directory or any</span><br><span class="line">        parent. Are you in the right directory?</span><br><span class="line"></span><br><span class="line">        Supported filenames: docker-compose.yml, docker-compose.yaml</span><br></pre></td></tr></table></figure>
<p>使用 docker-compose stop 来关闭Harbor和docker-compose start 关闭后进行重启。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 harbor]# docker-compose stop</span><br><span class="line">Stopping nginx              ... done</span><br><span class="line">Stopping harbor-portal      ... done</span><br><span class="line">Stopping harbor-jobservice  ... done</span><br><span class="line">Stopping harbor-core        ... done</span><br><span class="line">Stopping harbor-adminserver ... done</span><br><span class="line">Stopping registryctl        ... done</span><br><span class="line">Stopping harbor-db          ... done</span><br><span class="line">Stopping redis              ... done</span><br><span class="line">Stopping registry           ... done</span><br><span class="line">Stopping harbor-log         ... done</span><br><span class="line">[root@Web2 harbor]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@Web2 harbor]# docker-compose start</span><br><span class="line">Starting log         ... done</span><br><span class="line">Starting redis       ... done</span><br><span class="line">Starting adminserver ... done</span><br><span class="line">Starting registryctl ... done</span><br><span class="line">Starting registry    ... done</span><br><span class="line">Starting core        ... done</span><br><span class="line">Starting portal      ... done</span><br><span class="line">Starting jobservice  ... done</span><br><span class="line">Starting postgresql  ... done</span><br><span class="line">Starting proxy       ... done</span><br></pre></td></tr></table></figure>
<p>要更改Harbour的配置，要停止现有的Harbor实例并更新 harbor.cfg。然后运行 prepare 脚本以填充配置。最后重新创建并启动Harbor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose down -v</span><br><span class="line">vim harbor.cfg</span><br><span class="line">sudo prepare</span><br><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>默认情况下，注册表数据保留在主机的/data/目录中。即使Harbor的容器被移除和/或重新创建，此数据仍保持不变。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 data]# ls</span><br><span class="line">ca_download  config  database  job_logs  psc  redis  registry  secretkey</span><br><span class="line">[root@Web2 data]# cd registry/</span><br><span class="line">[root@Web2 registry]# tree</span><br><span class="line">.</span><br><span class="line">└── docker</span><br><span class="line">    └── registry</span><br><span class="line">        └── v2</span><br><span class="line">            ├── blobs</span><br><span class="line">            │   └── sha256</span><br><span class="line">            │       ├── 19</span><br><span class="line">            │       │   └── 196d12cf6ab19273823e700516e98eb1910b03b17840f9d5509f03858484d321</span><br><span class="line">            │       │       └── data</span><br><span class="line">            │       ├── 76</span><br><span class="line">            │       │   └── 76ebd8b93b384fe8121d87be22c2089843f663fb342f1e6345a0a0bd6424c5c2</span><br><span class="line">            │       │       └── data</span><br><span class="line">            │       └── c4</span><br><span class="line">            │           └── c432c1aab6335df5a9ff6237f8d19627f95ea7dc3f5709c555b2a28cd8df4d0a</span><br><span class="line">            │               └── data</span><br><span class="line">            └── repositories</span><br><span class="line">                └── library</span><br><span class="line">                    └── alpine</span><br><span class="line">                        ├── _layers</span><br><span class="line">                        │   └── sha256</span><br><span class="line">                        │       ├── 196d12cf6ab19273823e700516e98eb1910b03b17840f9d5509f03858484d321</span><br><span class="line">                        │       │   └── link</span><br><span class="line">                        │       └── c432c1aab6335df5a9ff6237f8d19627f95ea7dc3f5709c555b2a28cd8df4d0a</span><br><span class="line">                        │           └── link</span><br><span class="line">                        ├── _manifests</span><br><span class="line">                        │   ├── revisions</span><br><span class="line">                        │   │   └── sha256</span><br><span class="line">                        │   │       └── 76ebd8b93b384fe8121d87be22c2089843f663fb342f1e6345a0a0bd6424c5c2</span><br><span class="line">                        │   │           └── link</span><br><span class="line">                        │   └── tags</span><br><span class="line">                        │       └── latest</span><br><span class="line">                        │           ├── current</span><br><span class="line">                        │           │   └── link</span><br><span class="line">                        │           └── index</span><br><span class="line">                        │               └── sha256</span><br><span class="line">                        │                   └── 76ebd8b93b384fe8121d87be22c2089843f663fb342f1e6345a0a0bd6424c5c2</span><br><span class="line">                        │                       └── link</span><br><span class="line">                        └── _uploads</span><br><span class="line"></span><br><span class="line">29 directories, 8 files</span><br></pre></td></tr></table></figure>
<p>此外，Harbor使用 rsyslog 来收集每个容器的日志。默认情况下，这些日志文件存储在/var/log/harbor/目标主机上的目录中以进行故障排除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 registry]# cd /var/log/harbor/</span><br><span class="line">[root@Web2 harbor]# ls</span><br><span class="line">adminserver.log  core.log  jobservice.log  portal.log  postgresql.log  proxy.log  redis.log  registryctl.log  registry.log</span><br></pre></td></tr></table></figure>
<p>删除Harbor的容器，同时将图像数据和Harbor的数据库文件保存在文件系统上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose down -v</span><br></pre></td></tr></table></figure>
<p>删除Harbor的数据库和图像数据（用于重新安装）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -r / data / database </span><br><span class="line">rm -r / data / registry</span><br></pre></td></tr></table></figure>
<h3 id="自定义配置Harbor监听端口"><a href="#自定义配置Harbor监听端口" class="headerlink" title="自定义配置Harbor监听端口"></a>自定义配置Harbor监听端口</h3><h4 id="1-修改docker-compose-yml"><a href="#1-修改docker-compose-yml" class="headerlink" title="1.修改docker-compose.yml"></a>1.修改docker-compose.yml</h4><p>将默认的80:80 修改为8888:80，访问主机8888端口nginx容器就可以代理至harbor-portal容器的80端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">proxy:</span><br><span class="line">    image: goharbor/nginx-photon:v1.6.0</span><br><span class="line">    container_name: nginx</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - ./common/config/nginx:/etc/nginx:z</span><br><span class="line">    ports:</span><br><span class="line">      - 8888:80   //将默认的80:80 修改为8888:80</span><br><span class="line">      - 443:443</span><br><span class="line">    depends_on:</span><br><span class="line">      - postgresql</span><br><span class="line">      - registry</span><br><span class="line">      - core</span><br><span class="line">      - portal</span><br><span class="line">      - log</span><br><span class="line">    logging:</span><br><span class="line">      driver: &quot;syslog&quot;</span><br><span class="line">      options:  </span><br><span class="line">        syslog-address: &quot;tcp://127.0.0.1:1514&quot;</span><br><span class="line">        tag: &quot;proxy&quot;</span><br></pre></td></tr></table></figure>
<h4 id="2-修改harbor-cfg"><a href="#2-修改harbor-cfg" class="headerlink" title="2. 修改harbor.cfg"></a>2. 修改harbor.cfg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname = 172.18.74.101:8888</span><br></pre></td></tr></table></figure>
<h4 id="3-重新部署Harbor"><a href="#3-重新部署Harbor" class="headerlink" title="3.重新部署Harbor"></a>3.重新部署Harbor</h4><p>见上文</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>
<div>
    
 </div>
 
    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/profile_photo.png" alt="戴树谦">
            
              <p class="site-author-name" itemprop="name">戴树谦</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/CrimsonRomance" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:18632772539@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-fas fa-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">戴树谦</span>

  
</div>






  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
